(function(){var e,t,n,i,o,r,s,a,c,l,d,u,h,f,p,g,w,v,m,b,k,y,C,x,T,M,I,j,_,L,P,H,W,q,z,A,S,N,U,B,F,D,E,O,R,X,Q,V,Y,G,J,K,Z,ee,te,ne,ie,oe,re,se,ae,ce,le,de,ue,he,fe,pe,$e,ge,we,ve,me,be,ke,ye,Ce,xe,Te,Me,Ie,je,_e,Le,Pe,He,We,qe,ze,Ae,Se,Ne;window.raf=window.requestAnimationFrame,jQuery.browser.mobile&&!Modernizr.touch&&(Modernizr.touch=!0,jQuery("html").removeClass("no-touch").addClass("touch")),function(e){var s;window.scrollTop=0,window.$window=e(window),s={common:{init:function(){if(V()&&q(),V()&&Q()&&z(),Y()&&A(),n(O()?"on-chrome":"not-chrome",{html:!0}),e(".content").createMedia(),$window.scroll(Me(ve())),$window.resize(re()),$window.resize(be()),e(window).lazyLoadXT(),u(),ze(),Ne(),X())return Ce()},desktop:function(){return $window.scroll(p()),e("body").hasClass("project-overview")||($window.scroll(Me(he())),$window.resize(he())),qe()},mobile:function(){return e(".block h1,\n.block h2,\n.block h3,\n.block h4,\n.block h5,\n.block h6,\n.block article p,\n.block article p a,\n.block article p em,\n.block article blockquote,\n.block article li,\n.footnote,\n.related").hyphenate("en-us")},post:function(){return re(),raf(function(){return n("js-finished",{html:!0})})}},post_type_archive_project:{desktop:function(){return $window.scroll(Me(K()))},mobile:function(){return $window.on("orientationchange",Te())}},home:{init:function(){},desktop:function(){return $window.scroll(h),$window.on("mousewheel",F),Se(),fe(),r(),o(),te(),e(".block").setupBackgrounds(),i(function(){return e(".prev-image").on("click",ee),e(".next-image").on("click",E),L(),J()},1e3)},mobile:function(){return e(".block.writing").remove(),e(".block-slideshow").makeSlideshow({items:".block"}),e(".block").setupBackgrounds()}},project_overview:{desktop:function(){return console.log("project overview"),$window.resize(we()),$window.scroll($e()),We(),ce()},mobile:function(){return e(".image").setupBackgrounds().addCounters().find("img").click(function(){var t,n,i,o;if(e(".images").hasClass("is-small")&&!e(".images .container").hasTransitionClass())return i=e(".text .inner > h1, .text .inner > article, .related"),o=e(".images"),n=o.find(".container"),t=e(".banner"),i.hide(),o.removeClass("is-small"),t.css({position:"absolute"}),raf(function(){return n.css({visibility:"hidden"}),n.slickReinit(),re(),raf(function(){return n.css({visibility:""})})}),e(".menu-images").activate(),e(".menu-overview").deactivate().click(function(r){return r.preventDefault(),e(".menu-overview").activate(),e(".menu-images").deactivate(),i.show(),o.addClass("is-small"),t.css({position:""}),raf(function(){return n.css({visibility:"hidden"}),n.slickReinit(),re(),raf(function(){return n.css({visibility:""})})})})}),e(".images").addClass("is-small").addClass("should-show"),e(".images .container").makeSlideshow({items:".image"})}},project_images:{init:function(){return Se(),console.log("desktop")},desktop:function(){return $window.scroll(h),$window.on("mousewheel",F),fe(),r(),o(),e(".block").setupBackgrounds(),i(function(){return e(".prev-image").on("click",ee),e(".next-image").on("click",E),console.log("init slideshow"),L(),J()},1e3)},mobile:function(){return e(".block.writing").remove(),e(".block-slideshow").makeSlideshow({items:".block"}),e(".block").setupBackgrounds()}},single_writing:{desktop:function(){return $window.resize(g())}},page:{desktop:function(){return console.log("this is a page"),e("body").hasClass("contact")?de():(console.log("set current footnote"),t(),Ae())},mobile:function(){}},post_type_archive:{desktop:function(){return console.log("this is the news archive"),console.log("set current footnote")}},search:{init:function(){return e(".menu-search").activate()}},contact:{init:function(){return console.log("init"),de()}}},window.UTIL={fire:function(e,t,n){var i;if(i=s,t=null==t?"init":t,""!==e&&i[e]&&"function"==typeof i[e][t])return i[e][t](n)},loadEvents:function(){var e,t,n,i;for(UTIL.fire("common"),R()&&UTIL.fire("common","desktop"),V()&&UTIL.fire("common","mobile"),t=0,n=(i=document.body.className.replace(/-/g,"_").split(/\s+/)).length;t<n;t++)e=i[t],UTIL.fire(e),R()&&UTIL.fire(e,"desktop"),V()&&UTIL.fire(e,"mobile");return UTIL.fire("common","post")},load:function(){return R()&&N()?ye():(ne(),n("loaded",{html:!0}),UTIL.loadEvents())}},e(document).ready(UTIL.load)}(jQuery),je=0,Ie=0,W=[],c=[null,null,null,null,null,null,null,null,null],B=0,M=function(){return B>0?(B-=.3,!1):null!==c[0]&&(c[0]<c[4]&&c[1]<=c[4]&&c[2]<=c[4]&&c[3]<=c[4]&&c[5]<=c[4]&&c[6]<=c[4]&&c[7]<=c[4]&&c[8]<c[4]&&M)},d=function(e){return e.deltaY<0?E():ee()},F=function(e){var t;return e.preventDefault(),t=0,t="mousewheel"===e.type?-1*e.originalEvent.wheelDeltaY:40*e.originalEvent.detail,console.log("delta "+t),M()?(B=10,d(e)):null!==c[8]&&120!==c[8]||120!==Math.abs(t)||d(e),c.shift(),c.push(Math.abs(t)),F},ve=function(){return window.scrollTop=$window.scrollTop(),ve},p=function(){var e,t;return window.$sticky||(window.$sticky=$(".sticky-container")),window.stickyTop||(window.stickyTop=parseInt($(".sticky-container").css("top"))),!!$sticky.length&&(t=Math.max(0,$window.scrollTop()),e=Math.max(0,$window.scrollLeft()),Math.max(k(),stickyTop-t),-Math.min(parseInt($("body").css("min-width"))-$window.width(),e),p)},g=function(){return window.stickyTop=$("article").position().top,p(),g},h=function(){var e,t;return t=Math.max(0,$window.scrollLeft()),e=-Math.min(parseInt($("body").css("min-width"))-$window.width(),t),w().css({marginLeft:Math.min(0,e)}),h},f=function(){var e,t;return t=Math.max(0,$window.scrollLeft()),e=-Math.min(parseInt($("body").css("min-width"))-$window.width(),t),$(".popup .image, .project-images .banner").css({marginLeft:Math.min(0,e)}),h},o=function(){return $(document).keydown(function(e){switch(e.which){case 37:ee();break;case 39:E()}return e.preventDefault()}),o},he=function(){var e;return $(".popup").length||Q()||I("project-images")||null==(e=w().currentFromOffset())||e.isActive()||(w().setCurrent(e),He(e),$(".images .image").deactivate()),he},E=function(){return xe(),D(),E},ee=function(){return xe(),Z(),ee},D=function(){var e,t,n;return console.log("%c[next Image]","color:blue"),t=$(".image.block"),e=$(".image.block.active"),n="",n=e.index()<$(".image.block").length-1?$(".image.block").eq(e.index()+1):$(".image.block").eq(0),t.setCurrent(n),le(),D},Z=function(){var e,t,n;return console.log("prev Image"),t=$(".image.block"),e=$(".image.block.active"),n="",n=e.index()>0?$(".image.block").eq(e.index()-1):$(".image.block").eq($(".image.block").length-1),console.log(n),t.setCurrent(n),le(),Z},L=function(){return je=setInterval(D,3e3),console.log("initSlideshow"),le(),L},xe=function(){return clearInterval(je),clearTimeout(Ie),Ie=setTimeout(function(){return je=setInterval(D,6e3)},12e3),xe},fe=function(e){var t,n;return n=$(".block"),t=n.currentFromMousePosition(e),n.setCurrent(t),He(t),t.hasClass("excerpt_video")&&t.showMedia(),n.not(t).hideMedia(),fe},se=function(){var e,t,n,i;return e=$(".banner").position().top+$(".banner").height(),i=Number($(".content").css("padding-right").split("px").join("")),$(".overview-block .text").css("width",.444*$("body").outerWidth()-i/2),e+$(".overview-block .text").height()<$(window).height()?$(window).scrollTop()>e?($("body")[0].scrollHeight-$window.height(),t=$(window).scrollTop(),t-e,$(".overview-block .text").addClass("sticky").removeClass("fixed")):$(".overview-block .text").removeClass("sticky"):(n=Number($(".content").css("padding-bottom").split("px").join("")),$(window).scrollTop()>e+$(".overview-block .text").height()-$(window).height()+n&&!$(".container").hasClass("fixed")?$(".overview-block .text").addClass("fixed").removeClass("sticky"):$(".overview-block .text").removeClass("fixed"))},ae=function(){var e,t,n,i;return t=$(".banner").position().top+$(".banner").height(),i=Number($(".content").css("padding-right").split("px").join("")),Number($(".overview-block .text .inner").css("padding-right").split("px").join("")),$(".related-right").css("width",.222*$("body").outerWidth()-i/2),t+$(".related-right .inner").height()<$(window).height()?$(window).scrollTop()>t?(e=$("body").width()-$(".related-right").width(),$(".related-right").addClass("sticky").removeClass("fixed").css("left",e)):$(".related-right").removeClass("sticky").css("left",""):(n=Number($(".content").css("padding-bottom").split("px").join("")),console.log($(window).scrollTop()),console.log(t+$(".related-right .inner").height()-$(window).height()+n),$(window).scrollTop()>t+$(".related-right .inner").height()-$(window).height()+2*n?(e=$("body").width()-$(".related-right").width(),$(".related-right").addClass("fixed").css("left",e).removeClass("sticky")):$(".related-right").removeClass("fixed").css("left",""))},ce=function(){var e,t,n,i;if($(".sticky-container .related").height()+$(".sticky-container").position().top>$window.height())return e=($('.content[role="document"]').outerHeight()-$('.content[role="document"]').height())/2,t=$("body")[0].scrollHeight-$window.height(),n=$("body").scrollTop(),console.log(e),i=n/t*($(".sticky-container .related").height()-$window.height()+e),i=-i,void $(".sticky-container .related").css({"-webkit-transform":"translate(0px,"+i+"px)"})},we=function(){var e,t,n;for($e(),$("body").trigger("scroll"),t=$("body")[0].scrollHeight,n=$(".image").last().data("unique-set")+1,console.log("totalImages "+n),$(".images").activate(),W=[],e=1;e<=n;)W.push(t/e-$window.height()/n),e++;return W.reverse(),we},me=function(){return me},ge=function(){return $(".sticky-container").removeClass("all-visible"),$(".popup").length||raf(function(){var e,t,n,i;for(n=$(".image"),e=0,i=0;i<W.length;)$("body").scrollTop()>=W[i]&&(e=i),i++;return $("body").scrollTop()>=$("body")[0].scrollHeight-$window.height()?e=W.length-1:$("body").scrollTop()<=W[1]&&(e=0),(t=$(".image[data-unique-set="+e+"]")).hasClass("active")?$e:(n.not(t).deactivate(),t.each(function(){$(this).activate()}),n.active().showMedia(),n.inactive().hideMedia())}),ge},ue=function(){var e,t,n,i,o;return $(".sticky-container").addClass("all-visible"),n=Number($(".content").css("padding-bottom").split("px").join("")),i=Number($(".content").css("padding-right").split("px").join("")),t=Number($(".overview-block .text .inner").css("padding-right").split("px").join("")),console.log("pb "+i),o=$(".overview-block .sticky-container .container").height()+$(".overview-block").position().top-$(window).height()+4*n,$(".overview-block .sticky-container .container").css("width",.333*$("body").outerWidth()-t),console.log(o),console.log($("body").scrollTop()),$(window).scrollTop()>o?(e=$(".overview-block .text").width()+1.5*t,$(".overview-block .sticky-container .container").addClass("fixed").css("left",e)):$(".overview-block .sticky-container .container").removeClass("fixed").css("left",""),ue},$e=function(){return ue(),ae(),se(),me(),$e},pe=function(){return window.$footnotes||(window.$footnotes=$($(".footnote").get().reverse())),ce(),$(".popup").length||raf(function(){var e,t,n,i;for(n=$(".image"),t=0,i=0;i<W.length;)$("body").scrollTop()>=W[i]&&(t=i),i++;return $("body").scrollTop()>=$("body")[0].scrollHeight-$window.height()?t=W.length-1:$("body").scrollTop()<=W[1]&&(t=0),e=$(".image").eq(t),n.not(e).deactivate(),e.activate(),n.active().showMedia(),n.inactive().hideMedia()}),pe},u=function(){if($("#menu-projects-sub-navigation").length&&$(".menu-projects").activate(),$("#menu-research-sub-navigation").length&&$(".menu-research").activate(),$("#menu-information-sub-navigation").length&&$(".menu-info").activate(),I("post-type-archive-project"))return $(".menu-archive").activate()},le=function(){var e,t,n;return console.log("set captions"),t=$(".block.active"),e=$("body"),n=t.hasClass("white"),e.toggleClass("white-text",n),Pe(n),$(".description").dotdotdot({ellipsis:" [...]",watch:"window"}),$(".description").off("mouseenter mouseleave",_e),$(".description.is-truncated").on("mouseenter",ke).on("mouseleave",j)},ke=function(e){return e.stopPropagation(),$(".block.active .description").addClass("expanded"),$(".block.slick-active .description").addClass("expanded"),$(".block.active .description").trigger("destroy"),$(".block.slick-active .description").trigger("destroy"),console.log("show caption")},j=function(e){return e.stopPropagation(),$(".block.active .description").removeClass("expanded"),$(".block.slick-active .description").removeClass("expanded"),console.log("hide caption"),$(".description").dotdotdot({ellipsis:" [...]",watch:"window"})},_e=function(e){return e.stopPropagation(),$(".block.active .description").toggleClass("expanded"),$(".block.slick-active .description").toggleClass("expanded"),$(".block.active .description").hasClass("expanded")&&$(".block.active .description").hasClass("is-truncated")?(console.log("destroy elips"),$(".block.active .description").trigger("destroy")):$(".description").dotdotdot({ellipsis:" [...]",watch:"window"}),$(".block.slick-active .description").hasClass("expanded")&&$(".block.slick-active .description").hasClass("is-truncated")?(console.log("destroy elips"),$(".block.slick-active .description").trigger("destroy")):$(".description").dotdotdot({ellipsis:" [...]",watch:"window"}),xe()},t=function(){return $(".page-slideshow img").each(function(){return $(this).addClass("thumbnail")})},te=function(){return setTimeout(function(){return ie("init-slideshow"),$(".block-slideshow").removeClass("init-slideshow")},500)},s=function(){return xe(),ie("contents-hidden popup")},We=function(){return $(".images .image").on("click",function(e){if(!$(".popup").length)return $(this).openPopup({fakePage:!1,selectImage:$(e.currentTarget).index()})})},Ae=function(){return $(".page-slideshow .thumbnail").length&&($("#menu-primary-navigation").append('<button class="close"><i></i></button>'),$(".close").mouseenter(function(){return n("blur-content")}),$(".close").mouseleave(function(){return ie("blur-content")}),$(".close").click(function(){return s()})),$(".page-slideshow .thumbnail").on("click",function(){if(n("contents-hidden init-slideshow"),$(".block-slideshow .block").removeClass("active"),$(".block-slideshow .block").eq($(this).index()-1).addClass("active"),setTimeout(function(){return ie("init-slideshow")},500),!$(".popup").length)return $(this).openPopup({fakePage:!1}),n("popup")})},Ne=function(){return $(".subnav .active .controls a").click(function(e){var t,n;return e.preventDefault(),t=$(this),n=t.parents(".control-item").prevAll().length,$window.scrollTop($(".subsection").eq(n).offset().top-m())})},qe=function(){var e;return(e=$(".main-nav a")).mouseenter(function(){return n("blur-content")}),e.mouseleave(function(){return ie("blur-content")})},ze=function(){var e;return e=$(".newsletter-form"),$(".show-newsletter-form").click(function(){return e.toggle(),be()}),e.find(".submit").click(function(){return e.submit()})},be=function(){return $('form input[type="text"]').each(function(){var e,t,n,i;return(n=$(this)).parents(".input-wrapper").length||n.wrap('<div class="input-wrapper">'),i=n.parents(".input-wrapper"),t=n.parent().siblings("label"),e=n.parents("form"),i.css({marginLeft:t.outerWidth()}),n.css({width:e.width()-t.outerWidth()})}),be},de=function(){return $("#cscf").length&&(console.log("form exists"),$("#cscf_name").attr("placeholder","Name:").show(),$("#cscf_email").attr("placeholder","Email:").show(),$("#cscf_message").attr("placeholder","Message:").show(),$("#cscf_SubmitButton").attr("value","Submit").show()),de},re=function(){var e;return e=$(".popup .video-positioner").add(".home .excerpt_video .video-positioner").add(".slideshow .video-positioner").add(".touch .project-overview .video-positioner").add(window.backgroundImages),raf(function(){return l(oe,e)}),re},l=function(e,t){return $.each(t,function(t,n){return e(n)})},oe=function(e,t){var n,i,o,r,s,a,c,l,d,u,h;if(null==t&&(t={}),n=$(e),l=n.data("ratio"),o=(!Y()||!$(".is-small").length)&&n.data("full-bleed"),a=n.largeImagePadding(),R()?(h=Math.max(T(),1120),d=x()):(c=I("project-images")?".image":Y()?".image":".block",h=(i=n.parents(c)).outerWidth(),d=i.outerHeight()),o?(r=(u=h)/l)<d&&(u=(r=d)*l):(s=d-2*a.y,(r=(u=h-2*a.x)/l)>s&&(u=(r=s)*l)),n.css({position:"absolute",top:"50%",left:"50%",marginLeft:-u/2,marginTop:-r/2,height:r,width:u}),V()&&!o)return $(this).backgroundCaption().css({position:"absolute",top:"50%",bottom:"auto",marginTop:r/2+k()/2,textAlign:"center"})},$.fn.largeImagePadding=function(){var e,t,n;return Y()&&$(".is-small").length?{x:m(),y:0}:V()?(n=H()?G()?4.5:3.5:2.5,{x:m(),y:m()+k()*n}):(e=$(this).backgroundCaption(),t=Math.max(k(),e.height()),{x:m(),y:m()+k()+t})},$.fn.backgroundCaption=function(){return Q()?$(this).parents(".block-inner").find("h1"):$(this).parents(".image").find(".caption")},r=function(){return raf(function(){return $(".block").each(function(e,t){return $(t).calculateExcerpt()})})},Se=function(){return $(".block").click(function(e){if(e.preventDefault(),Q()){if(!$(e.target).hasClass("slideshow-nav"))return e.clientX>.5*$(window).width()?E():ee()}else if(!$(e.target).hasClass("slideshow-nav")&&!$("body").hasClass("contents-hidden"))return e.clientX>.5*$(window).width()?E():ee()})},J=function(){return $(".video-player").each(function(e,t){var n;return n=$(t),n.offset().top,n.play()}),J},K=function(){return $(".video-player").each(function(e,t){var n,i;return n=$(t),(i=n.offset().top)>window.scrollTop-n.outerHeight()&&i<window.scrollTop+2*$window.height()?n.play():n.pause()}),console.log("play visible videos"),K},q=function(){var e;return e=$("table"),$('<div class="liberated-blocks">').append(e.find(".block").clone()).insertBefore(e)},z=function(){return $(".block.expanded").each(function(){var e,t,n,i,o;return(e=$(this)).find(".related, article").remove(),e.removeClass("expanded"),i=e.find(".images"),(n=i.find(".image:first-child")).hasClass("video")?(o=n.find(".video-player"),e.addClass("excerpt_video")):(t=n.find("img"),o=$('<div class="background"></div>').attr("data-full-bleed",t.attr("data-full-bleed")).attr("data-ratio",t.attr("data-ratio")).attr("data-image",t.attr("src")),e.addClass("excerpt")),i.replaceWith(o)})},A=function(){return $(".images").insertAfter($(".text h1").first())},_=function(){var e;if(!(e=y()).hasClass("do-blur"))return e.is(":visible")?(n("loaded",{html:!0}),e.trigger("loaded"),e.stop().fadeOut(400),$(".video-player.should-play").parent().showMedia()):void 0;e.data("hold",!0)},ye=function(){var e,t;return t=y(),e=w().find(".background").first().clone(),t.find(".headline").mouseenter(function(){return t.addClass("do-blur")}).mouseleave(function(){if(t.removeClass("do-blur"),t.data("hold"))return _()}),e.length&&(e.css({opacity:0}),t.toggleClass("white-text",e.parents(".block").hasClass("white")),t.prepend(e),t.imagesLoaded(function(){return e.fadeTo(400,1)})),setTimeout(_,4e3),t.click(_),raf(function(){return t.show(),U(),UTIL.loadEvents()})},i=function(e,t){return y().length?y().on("loaded",function(){return setTimeout(e,t)}):e()},N=function(){return!!y().length&&!S()},S=function(){return null!=$.cookie("loader_shown")},U=function(){return $.cookie("loader_shown",!0)},Te=function(){return P()&&$("table .block").hide().css({width:$("table").width()/2}).show(),Te},Ce=function(){var e,t,i,o,r,s;for(n("flash-video",{html:!0}),t=function(){return Q()?($(".block.excerpt_video").active().showMedia(),$(".block.expanded .image:visible").showMedia()):I("post-type-archive-project")?K():$(".image").active().showMedia()},s=[],i=0,o=(r=[1e3,2e3,4e3]).length;i<o;i++)e=r[i],s.push(setTimeout(t,e));return s},V=function(){return Modernizr.touch},R=function(){return!Modernizr.touch},Q=function(){return I("home")},O=function(){return null!=window.chrome},X=function(){return/firefox/i.test(navigator.userAgent)},P=function(){return!!(window.orientation%180)},H=function(){return!P()},G=function(){return screen.availWidth<400},Y=function(){return V()&&I("project-overview")},Me=function(e,t,n){var i,o;return null==t&&(t=100),o=void 0,i=void 0,function(){var r,s;return r=n||this,s=+new Date,arguments,o&&s<o+t?(clearTimeout(i),i=setTimeout(function(){return o=s,raf(e.bind(r))},t)):(o=s,raf(e.bind(r)))}},k=function(){return parseInt(v().css("line-height"))},m=function(){return window.$bodyPadding||(window.$bodyPadding=$("#body-padding")),parseInt(window.$bodyPadding.css("height"))},T=function(){return V()?H()?screen.availWidth:screen.availHeight:$window.width()},x=function(){return V()?H()?screen.availHeight:screen.availWidth:$window.height()},w=function(){return window.$blocks=$($(".block").get().reverse()),window.$blocks},v=function(){return window.$body||(window.$body=$("body")),window.$body},b=function(){return window.$_html||(window.$_html=$("html")),window.$_html},y=function(){return window.$_loader||(window.$_loader=$("#loader")),window.$_loader},ne=function(){return y().remove(),delete window.$_loader},I=function(e,t){return null==t&&(t={}),C(t).hasClass(e)},Le=function(e,t,n){return null==n&&(n={}),C(n).toggleClass(e,t)},n=function(e,t){return null==t&&(t={}),C(t).addClass(e)},ie=function(e,t){return null==t&&(t={}),C(t).removeClass(e)},Pe=function(e){return Le("white-text",e)},He=function(e){return Pe(e.hasClass("white"))},C=function(e){return null==e&&(e={}),e.html?b():v()},$.fn.activate=function(){return $(this).addClass("active")},$.fn.deactivate=function(){return $(this).removeClass("active")},$.fn.isActive=function(){return $(this).hasClass("active")},$.fn.active=function(){return $(this).filter(".active")},$.fn.inactive=function(){return $(this).not(".active")},$.fn.createMedia=function(){return $(this).eachVideo(a)},$.fn.showMedia=function(){var e;return e=$(this),e.find(".video-player").each(function(e,t){var n;return(n=$(t)).sizeMedia(),Q()&&!I("loaded",{html:!0})?n.addClass("should-play"):n.play()}),e},$.fn.sizeMedia=function(){var e,t,n,i,o;return t=$(this),e=t.find(".video-positioner"),o=e.data("ratio"),i=t.parents(".popup").length||t.parents(".slideshow").length||Y()||Q()&&t.parents(".excerpt_video").length,t.toggleClass("inline-video",!i),n=e.data("poster"),i?e.css({paddingTop:""}):e.css({paddingTop:100/o+"%",width:"100%",height:0,position:"",height:"",margin:"",top:"",left:"",backgroundImage:'url("'+n+'")'})},$.fn.hideMedia=function(){var e;return e=$(this),e.find(".video-player").each(function(e,t){return $(t).pause()}),e},$.fn.eachVideo=function(e){var t,n,i,o;for(n=0,i=(o=(t=$(this)).find(".video-player").get()).length;n<i;n++)e(o[n]);return t},$.fn.play=function(){var e,t,n;if(e=$(this),n=e.data("videojs"),t=e.data("play-sound"),null!=n?n.hasLoaded:void 0)try{return n.ready(function(){return"Flash"===this.techName&&(e.hasClass("is-loaded")||n.one("loadeddata",function(){return setTimeout(function(){return raf(function(){return e.addClass("is-loaded")})},50)}),this.muted(!t)),this.play()})}catch(e){e}},$.fn.pause=function(){var e;if(null!=(e=$(this).data("videojs"))?e.hasLoaded:void 0)return e.ready(function(){return this.pause()})},a=function(e){var t,n;if("undefined"!=typeof videojs&&null!==videojs)return t=$(e),null==(n=t.data("videojs"))&&((n=videojs(t.find("video").get(0))).volume(t.data("play-sound")?1:0),n.controls(!1),V()?(n.height(1),n.width(1)):(n.height("100%"),n.width("100%")),n.ready(function(){return this.hasLoaded=!0}),$(n.el()).addClass("vjs-player"),t.find(".play-button").on("click",function(e){if(e.stopPropagation(),e.preventDefault(),n.hasLoaded)return n.play(),n.requestFullscreen()}),t.sizeMedia(),t.data("videojs",n)),n},$.fn.backgroundFrom=function(e){var t,n,i;if(window.backgroundImages||(window.backgroundImages=[]),t=$(this),i=e.data("image")||e.attr("src"),!t.find("img").length)return(n=$("<img>",{src:i,class:"background-image"})).attr("data-ratio",e.data("ratio")),n.attr("data-full-bleed",e.data("full-bleed")),n.css({display:"block"}),n.appendTo(t),backgroundImages.push(n),e.css({display:""}),oe(n),t},$.fn.setupBackgrounds=function(){return $(this).each(function(e,t){var n;return(n=$(t).find(".background")).backgroundFrom(n)})},$.fn.currentFromOffset=function(e){var t,n,i;return null==e&&(e={}),n=null,t=$(this),i=e.hold||(e.hold=0),t.each(function(e,o){var r,s,a;if(r=$(o),a=r.offset().top,s=m(),i>0){if(a<=window.scrollTop+s&&a+r.height()+i>=window.scrollTop-s||a>=window.scrollTop&&e===t.length-1)return n=r,!1}else if(Q()&&(s+=$window.height()/2),a<=window.scrollTop+s||e===t.length-1)return n=r,!1}),n},$.fn.currentFromMousePosition=function(e,t){var n,i,o;return null==t&&(t={}),n=$(this),!(null!=e&&n.length>1)||Q()&&y().is(":visible")?null!=t.default?n.eq(t.default):n.first():(o=e.pageX-$window.scrollLeft(),i=$window.width()/n.length,n.eq(Math.min(n.length-1,Math.floor(o/i))))},$.fn.setCurrent=function(e){if(setTimeout(function(){return $(".block-init").removeClass("block-init")},500),!e.isActive())return $(this).not(e).deactivate().trigger("deactivate"),e.activate().trigger("activate")},$.fn.hasTransitionClass=function(){return $(this).hasClass("is-swiping")},$.fn.addTransitionClass=function(){var e;if(!(e=$(this)).hasClass("is-swiping"))return e.addClass("is-swiping")},$.fn.removeTransitionClass=function(){return $(this).removeClass("is-swiping")},$.fn.makeSlideshow=function(e){var t,n,i,o,r,s;return null==e&&(e={}),t=$(this),r='<div data-role="none" class="previous">Previous</div>',o='<div data-role="none" class="next">Next</div>',i=function(e){return function(){return $(e).addTransitionClass()}}(this),n=function(){var e;return e=this.$slides.eq(this.currentSlide),Y()||He(e),this.$slider.removeTransitionClass(),le()},s={arrows:!0,dots:!1,infinite:!1,slide:e.items||".image",prevArrow:r,nextArrow:o,onAfterChange:n},t.slick(s).on("touchmove.slick",i).on("click",".previous:not(.slick-disabled)",i).on("click",".next:not(.slick-disabled)",i).find(".previous, .next").css({display:""}),Y()||He(t.find(".slick-active")),le(),t},$.fn.openPopup=function(e){var t,r,s,a;if(null==e&&(e={}),!$(".popup").length)return setTimeout(function(){return Se()},500),s=$(".image"),t=$(".image").eq(e.selectImage),s.not(t).deactivate(),s.active().showMedia(),s.inactive().hideMedia(),a=$(this),r=a.parents(".images"),s=r.find(".image"),$("body").hasClass("page")&&(s=(r=a.parents(".page-slideshow")).find(".thumbnail")),s.addCounters(),s.setupBackgrounds(),V()?(r.addClass("slideshow"),s.each(function(e,t){var n;return(n=$(t)).activate(),n.showMedia()}),r.find(".container").makeSlideshow(),re()):($window.on("mousewheel",F),o(),$(".block-slideshow .block").first().addClass("active"),$(".block-slideshow .block").setupBackgrounds(),L(),i(function(){return $(".prev-image").on("click",ee),$(".next-image").on("click",E),console.log("init slideshow"),J()},1e3),r.addClass("popup"),n("contents-hidden")),le()},$.fn.fanImages=function(e){var t,n,i,o,r;return null==e&&(e={}),n=$(this),t=i=n.parents(".images"),I("project-overview")&&(o=window.scrollTop,$(".menu-images").activate(),$(".menu-overview").deactivate().click(function(e){return e.preventDefault(),$(".menu-overview").activate(),$(".menu-images").deactivate(),i.unbind("mousemove"),i.removeClass("popup"),i.hideMedia().show(),$window.unbind("scroll.popup"),ie("blur-content"),ie("contents-hidden"),$(".wrap").css({height:""}),$window.scrollTop(o),$window.trigger("scroll"),$window.trigger("resize")})),r=function(i){var o,s;if(!(o=n.currentFromMousePosition(i,{default:e.currentIndex})).isActive()){s=o.hasClass("white"),n.setCurrent(o),t.toggleClass("white-text",s),Pe(s);try{o.showMedia(),n.not(o).hideMedia()}catch(e){e}re()}return r},$window.on("scroll.popup",f),setTimeout(function(){return t.on("mousemove",r)},200),r()},$.fn.addCounters=function(){var e;if((e=$(this)).length>1)return e.each(function(t,n){return'<div class="counter">'+(t+1)+"/"+e.length+"</div>",$(n).find(".caption-inner")})},$.fn.openHref=function(){var e;if(null!=(e=$(this).data("href")))return window.location=e},$.fn.openSelectProjects=function(){var e;if(null!=(e=$(".menu-projects a").attr("href")+"/type/selected"))return window.location=e},$.fn.calculateExcerpt=function(){var t,n;return t=$(this),null==(n=t.data("excerptCalculator"))&&(n=new e(t),t.data("excerptCalculator",n)),(V()||!Q()||t.hasClass("active"))&&n.render(),t},$.fn.slickReinit=function(){return $(this).slickSetOption("_",!0,!0)},e=function(){function e(e){this.block=e,this.$article=this.block.find("article").first(),this.$images=this.block.find(".images .image"),this.$related=this.block.find(".related_post"),$window.on("resize",this.render.bind(this)),this.block.on("activate",this.render.bind(this)),V()&&$window.on("orientationchange",this.render.bind(this))}return e.prototype.render=function(){return raf(function(e){return function(){var t,n;return n=e.getTargetHeight(),t=e.approximateWidth(),e.currentHeight===n&&e.currentWidth===t||(e.$article.length&&e.truncateArticle(n,t),e.$images.length&&e.truncateImages(n,t),e.$related.length&&e.truncateRelated(n,t)),e.$images.filter(":visible").showMedia(),e.$images.not(":visible").hideMedia(),e.currentHeight=n,e.currentWidth=t}}(this))},e.prototype.truncateArticle=function(e,t){var n,i,o,r,s,a,c,l,d,u;if(V()&&(e-=this.block.find("h1").outerHeight(!0)),R()&&Q()&&(e-=2*k()),this.paragraphs||(this.paragraphs=this.getParagraphs()),o=!1,this.$article.empty(),e>k()){for(s=0,c=(d=this.paragraphs).length;s<c;s++)if(i=d[s],n=i.el.clone(),this.$article.append(n),this.$article.height()>e){for(n.empty(),a=0,l=(u=i.words).length;a<l;a++)if(r=u[a],n.append(r.clone()," "),this.$article.height()>e){o=!0;break}break}return o&&(n.find("> span:last-child").remove(),n.find("> span:last-child").remove(),n.find("> span").length&&n.append("<span>[&hellip;]</span>")),this.$article.html(this.$article.html())}},e.prototype.truncateImages=function(e,t){var n,i,o,r,s,a,c;for(e+=k()*(null!=(s=V())?s:{1:3}),this.$images.hide(),c=[],o=0,r=(a=this.$images).length;o<r;o++){if(i=a[o],(n=$(i)).show(),this.imagesHeight()>e){n.hide();break}c.push(void 0)}return c},e.prototype.imagesHeight=function(){return this.$imagesContainer||(this.$imagesContainer=this.block.find(".images")),this.$imagesContainer.height()},e.prototype.truncateRelated=function(e,t){var n,i,o,r,s,a;for(e+=3*k(),this.$related.hide(),a=[],o=0,r=(s=this.$related).length;o<r;o++){if(i=s[o],(n=$(i)).showMedia().show(),this.relatedHeight()>e){n.hideMedia().hide();break}a.push(void 0)}return a},e.prototype.relatedHeight=function(){return this.$relatedContainer||(this.$relatedContainer=this.block.find(".related")),this.$relatedContainer.height()},e.prototype.getTargetHeight=function(){var e,t,n;return V()&&(this.block.hasClass("writing")||this.block.hasClass("expanded"))?((e=parseInt(this.block.css("max-height")))||(e=this.block.height()),e-2*k()):(t=3*m()+3*k()-5,(n=$window.height())-t-n%k())},e.prototype.getParagraphs=function(){var e;return e=[],this.$article.find("p").each(function(t){return function(n,i){var o;return o=t.getWords(i),i=$(i).clone(),e.push({el:i,words:o})}}(this)),e},e.prototype.getWords=function(e){var t,n,i,o,r;for(r=[],n=0,i=(o=this.getText(e).split(" ")).length;n<i;n++)t=o[n],r.push(this.makeWord(t));return r},e.prototype.getText=function(e){return $.trim($(e).text())},e.prototype.makeWord=function(e){return $("<span>").html(e.replace(/SO\u2013IL/,'<span class="wordmark">SO<span class="hyphen">&ndash;</span>IL</span>'))},e.prototype.approximateWidth=function(){var e;return(e=this.$article.width())-e%10},e}()}).call(this);