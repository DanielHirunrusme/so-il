(function(){var e,t,n,i,o,r,a,s,c,l,d,u,h,f,p,g,v,w,m,b,k,y,C,T,x,M,I,j,_,L,H,P,q,z,W,A,S,U,B,F,D,E,O,R,N,X,Q,V,Y,G,J,K,Z,ee,te,ne,ie,oe,re,ae,se,ce,le,de,ue,he,fe,pe,ge,$e,ve,we,me,be,ke,ye,Ce,Te,xe,Me,Ie,je,_e,Le,He,Pe,qe,ze,We,Ae,Se,Ue,Be,Fe,De,Ee,Oe;window.raf=window.requestAnimationFrame,jQuery.browser.mobile&&!Modernizr.touch&&(Modernizr.touch=!0,jQuery("html").removeClass("no-touch").addClass("touch")),U=function(e){var a;return window.scrollTop=0,window.$window=e(window),a={common:{init:function(){return X()&&P(),X()&&N()&&q(),Q()&&z(),n(E()?"on-chrome":"not-chrome",{html:!0}),e(".content").createMedia(),$window.scroll(Le(ye())),$window.resize(re()),$window.resize(Te()),e(window).lazyLoadXT(),l(),Fe(),Oe(),R()?Ie():void 0},desktop:function(){return $window.scroll(h()),e("body").hasClass("project-overview")||($window.scroll(Le(ge())),$window.resize(ge())),Be()},mobile:function(){return e(".block h1,\n.block h2,\n.block h3,\n.block h4,\n.block h5,\n.block h6,\n.block article p,\n.block article p a,\n.block article p em,\n.block article blockquote,\n.block article li,\n.footnote,\n.related").hyphenate("en-us")},post:function(){return re(),raf(function(){return n("js-finished",{html:!0})})}},post_type_archive_project:{desktop:function(){return $window.scroll(Le(K()))},mobile:function(){return $window.on("orientationchange",_e())}},home:{init:function(){},desktop:function(){return $window.scroll(d),$window.on("mousewheel",B),Ee(),$e(),r(),o(),te(),e(".block").setupBackgrounds(),i(function(){return e(".prev-image").on("click",ee),e(".next-image").on("click",D),I(),J()},1e3)},mobile:function(){return e(".block.writing").remove(),e(".block-slideshow").makeSlideshow({items:".block"}),e(".block").setupBackgrounds()}},project_overview:{desktop:function(){return console.log("project overview"),$window.resize(ke()),$window.scroll(we()),Ue(),ce()},mobile:function(){return e(".image").setupBackgrounds().addCounters().find("img").click(function(){var t,n,i,o;return e(".images").hasClass("is-small")&&!e(".images .container").hasTransitionClass()?(i=e(".text .inner > h1, .text .inner > article, .related"),o=e(".images"),n=o.find(".container"),t=e(".banner"),i.hide(),o.removeClass("is-small"),t.css({position:"absolute"}),raf(function(){return n.css({visibility:"hidden"}),n.slickReinit(),re(),raf(function(){return n.css({visibility:""})})}),e(".menu-images").activate(),e(".menu-overview").deactivate().click(function(r){return r.preventDefault(),e(".menu-overview").activate(),e(".menu-images").deactivate(),i.show(),o.addClass("is-small"),t.css({position:""}),raf(function(){return n.css({visibility:"hidden"}),n.slickReinit(),re(),raf(function(){return n.css({visibility:""})})})})):void 0}),e(".images").addClass("is-small").addClass("should-show"),e(".images .container").makeSlideshow({items:".image"})}},project_images:{init:function(){return Ee(),console.log("desktop")},desktop:function(){return $window.scroll(d),$window.on("mousewheel",B),$e(),r(),o(),e(".block").setupBackgrounds(),i(function(){return e(".prev-image").on("click",ee),e(".next-image").on("click",D),console.log("init slideshow"),I(),J()},1e3)},mobile:function(){return e(".block.writing").remove(),e(".block-slideshow").makeSlideshow({items:".block"}),e(".block").setupBackgrounds()}},single_writing:{desktop:function(){return $window.resize(f())}},page:{desktop:function(){return console.log("this is a page"),e("body").hasClass("contact")?fe():(console.log("set current footnote"),t(),De())},mobile:function(){}},post_type_archive:{desktop:function(){return console.log("this is the news archive"),console.log("set current footnote")}},search:{init:function(){return e(".menu-search").activate()}},contact:{init:function(){return console.log("init"),fe()}}},window.UTIL={fire:function(e,t,n){var i;return i=a,t=null==t?"init":t,""!==e&&i[e]&&"function"==typeof i[e][t]?i[e][t](n):void 0},loadEvents:function(){var e,t,n,i;for(UTIL.fire("common"),O()&&UTIL.fire("common","desktop"),X()&&UTIL.fire("common","mobile"),i=document.body.className.replace(/-/g,"_").split(/\s+/),t=0,n=i.length;n>t;t++)e=i[t],UTIL.fire(e),O()&&UTIL.fire(e,"desktop"),X()&&UTIL.fire(e,"mobile");return UTIL.fire("common","post")},load:function(){return O()&&A()?Me():(ne(),n("loaded",{html:!0}),UTIL.loadEvents())}},e(document).ready(UTIL.load)},U(jQuery),Pe=0,He=0,le=0,_=!1,ue=0,H=[],de=0,B=function(e){return console.log(e),$("body").hasClass("scrolling")?!0:(n("scrolling"),setTimeout(function(){return ie("scrolling")},1e3),e.deltaY<0?D():ee(),B)},ye=function(){return window.scrollTop=$window.scrollTop(),ye},h=function(){var e,t,n,i;return window.$sticky||(window.$sticky=$(".sticky-container")),window.stickyTop||(window.stickyTop=parseInt($(".sticky-container").css("top"))),$sticky.length?(n=Math.max(0,$window.scrollTop()),t=Math.max(0,$window.scrollLeft()),i=Math.max(m(),stickyTop-n),e=-Math.min(parseInt($("body").css("min-width"))-$window.width(),t),$sticky.css({top:i,marginLeft:Math.min(0,e)}),h):!1},f=function(){return window.stickyTop=$("article").position().top,h(),f},d=function(){var e,t;return t=Math.max(0,$window.scrollLeft()),e=-Math.min(parseInt($("body").css("min-width"))-$window.width(),t),p().css({marginLeft:Math.min(0,e)}),d},u=function(){var e,t;return t=Math.max(0,$window.scrollLeft()),e=-Math.min(parseInt($("body").css("min-width"))-$window.width(),t),$(".popup .image, .project-images .banner").css({marginLeft:Math.min(0,e)}),d},o=function(){return $(document).keydown(function(e){switch(e.which){case 37:ee();break;case 39:D()}return e.preventDefault()}),o},ge=function(){var e;return $(".popup").length||N()||T("project-images")||(e=p().currentFromOffset(),null==e||e.isActive()||(p().setCurrent(e),Ae(e),$(".images .image").deactivate())),ge},D=function(){return je(),F(),D},ee=function(){return je(),Z(),ee},F=function(){var e,t,n;return console.log("%c[next Image]","color:blue"),t=$(".image.block"),e=$(".image.block.active"),n="",n=e.index()<$(".image.block").length-1?$(".image.block").eq(e.index()+1):$(".image.block").eq(0),t.setCurrent(n),he(),F},Z=function(){var e,t,n;return console.log("prev Image"),t=$(".image.block"),e=$(".image.block.active"),n="",n=e.index()>0?$(".image.block").eq(e.index()-1):$(".image.block").eq($(".image.block").length-1),console.log(n),t.setCurrent(n),he(),Z},I=function(){return Pe=setInterval(F,3e3),console.log("initSlideshow"),he(),I},je=function(){return clearInterval(Pe),clearTimeout(He),He=setTimeout(function(){return Pe=setInterval(F,6e3)},12e3),je},$e=function(e){var t,n;return n=$(".block"),t=n.currentFromMousePosition(e),n.setCurrent(t),Ae(t),t.hasClass("excerpt_video")&&t.showMedia(),n.not(t).hideMedia(),$e},ae=function(){var e,t,n,i;return console.log("scroll overview"),console.log($("body").scrollTop()),e=$(".banner").position().top+$(".banner").height(),console.log(e),$("body").scrollTop()>e?(t=$("body")[0].scrollHeight-$window.height(),n=$("body").scrollTop(),i=n-e,$(".overview-block .text").addClass("sticky")):$(".overview-block .text").removeClass("sticky")},se=function(){var e,t,n,i;return console.log($("body").scrollTop()),e=$(".banner").position().top+$(".banner").height(),console.log(e),$("body").scrollTop()>e?(t=$("body")[0].scrollHeight-$window.height(),n=$("body").scrollTop(),i=n-e,$(".related-right").addClass("sticky")):$(".related-right").removeClass("sticky")},ce=function(){var e,t,n,i;return $(".sticky-container .related").height()+$(".sticky-container").position().top>$window.height()?(e=($('.content[role="document"]').outerHeight()-$('.content[role="document"]').height())/2,t=$("body")[0].scrollHeight-$window.height(),n=$("body").scrollTop(),console.log(e),i=n/t*($(".sticky-container .related").height()-$window.height()+e),i=-i,void $(".sticky-container .related").css({"-webkit-transform":"translate(0px,"+i+"px)"})):void 0},be=function(){var e,t,n;for(t=$("body")[0].scrollHeight,n=$(".image").length,$(".images").activate(),e=1;n>=e;)H.push(t/e-$window.height()/4),e++;return H.reverse()},ke=function(){var e,t,n;for(we(),$("body").trigger("scroll"),t=$("body")[0].scrollHeight,n=$(".image").last().data("unique-set")+1,console.log("totalImages "+n),$(".images").activate(),H=[],e=1;n>=e;)H.push(t/e-$window.height()/n),e++;return H.reverse(),ke},Ce=function(){return Ce},me=function(){return $(".sticky-container").removeClass("all-visible"),$(".popup").length||raf(function(){var e,t,n,i;for(n=$(".image"),e=0,i=0;i<H.length;)$("body").scrollTop()>=H[i]&&(e=i),i++;return $("body").scrollTop()>=$("body")[0].scrollHeight-$window.height()?e=H.length-1:$("body").scrollTop()<=H[1]&&(e=0),t=$(".image[data-unique-set="+e+"]"),t.hasClass("active")?we:(n.not(t).deactivate(),t.each(function(){var e;e=$(this),e.activate()}),n.active().showMedia(),n.inactive().hideMedia())}),me},pe=function(){return console.log("setContentSticky"),$(".sticky-container").addClass("all-visible"),pe},we=function(){return $(".overview-block").position().top+$(".overview-block").height()<$(window).height()?(pe(),ae(),$(".related-right").height()<$(window).height()&&se()):me(),Ce(),ce(),we},ve=function(){return window.$footnotes||(window.$footnotes=$($(".footnote").get().reverse())),ce(),$(".popup").length||raf(function(){var e,t,n,i;for(n=$(".image"),t=0,i=0;i<H.length;)$("body").scrollTop()>=H[i]&&(t=i),i++;return $("body").scrollTop()>=$("body")[0].scrollHeight-$window.height()?t=H.length-1:$("body").scrollTop()<=H[1]&&(t=0),e=$(".image").eq(t),n.not(e).deactivate(),e.activate(),n.active().showMedia(),n.inactive().hideMedia()}),ve},l=function(){return $("#menu-projects-sub-navigation").length&&$(".menu-projects").activate(),$("#menu-research-sub-navigation").length&&$(".menu-research").activate(),$("#menu-information-sub-navigation").length&&$(".menu-info").activate(),T("post-type-archive-project")?$(".menu-archive").activate():void 0},he=function(){var e,t,n;return console.log("set captions"),t=$(".block.active"),e=$("body"),n=t.hasClass("white"),e.toggleClass("white-text",n),We(n),$(".description").dotdotdot({ellipsis:" [...]",watch:"window"}),$(".description").off("mouseenter mouseleave",qe),$(".description.is-truncated").on("mouseenter",xe).on("mouseleave",x)},xe=function(e){return e.stopPropagation(),$(".block.active .description").addClass("expanded"),$(".block.slick-active .description").addClass("expanded"),$(".block.active .description").trigger("destroy"),$(".block.slick-active .description").trigger("destroy"),console.log("show caption")},x=function(e){return e.stopPropagation(),$(".block.active .description").removeClass("expanded"),$(".block.slick-active .description").removeClass("expanded"),console.log("hide caption"),$(".description").dotdotdot({ellipsis:" [...]",watch:"window"})},qe=function(e){return e.stopPropagation(),$(".block.active .description").toggleClass("expanded"),$(".block.slick-active .description").toggleClass("expanded"),$(".block.active .description").hasClass("expanded")&&$(".block.active .description").hasClass("is-truncated")?(console.log("destroy elips"),$(".block.active .description").trigger("destroy")):$(".description").dotdotdot({ellipsis:" [...]",watch:"window"}),$(".block.slick-active .description").hasClass("expanded")&&$(".block.slick-active .description").hasClass("is-truncated")?(console.log("destroy elips"),$(".block.slick-active .description").trigger("destroy")):$(".description").dotdotdot({ellipsis:" [...]",watch:"window"}),je()},t=function(){return $(".page-slideshow img").each(function(){return $(this).addClass("thumbnail")})},te=function(){return setTimeout(function(){return ie("init-slideshow"),$(".block-slideshow").removeClass("init-slideshow")},500)},a=function(){return je(),ie("contents-hidden popup")},Ue=function(){return $(".images .image").on("click",function(e){return $(".popup").length?void 0:$(this).openPopup({fakePage:!1,selectImage:$(e.currentTarget).index()})})},De=function(){return $(".page-slideshow .thumbnail").length&&($("#menu-primary-navigation").append('<button class="close"><i></i></button>'),$(".close").mouseenter(function(){return n("blur-content")}),$(".close").mouseleave(function(){return ie("blur-content")}),$(".close").click(function(){return a()})),$(".page-slideshow .thumbnail").on("click",function(){return n("contents-hidden init-slideshow"),$(".block-slideshow .block").removeClass("active"),$(".block-slideshow .block").eq($(this).index()-1).addClass("active"),setTimeout(function(){return ie("init-slideshow")},500),$(".popup").length?void 0:($(this).openPopup({fakePage:!1}),n("popup"))})},Oe=function(){var e;return e=$(".subnav .active .controls a"),e.click(function(e){var t,n;return e.preventDefault(),t=$(this),n=t.parents(".control-item").prevAll().length,$window.scrollTop($(".subsection").eq(n).offset().top-v())})},Be=function(){var e;return e=$(".main-nav a"),e.mouseenter(function(){return n("blur-content")}),e.mouseleave(function(){return ie("blur-content")})},Fe=function(){var e;return e=$(".newsletter-form"),$(".show-newsletter-form").click(function(){return e.toggle(),Te()}),e.find(".submit").click(function(){return e.submit()})},Te=function(){var e;return e=$('form input[type="text"]'),e.each(function(){var e,t,n,i;return n=$(this),n.parents(".input-wrapper").length||n.wrap('<div class="input-wrapper">'),i=n.parents(".input-wrapper"),t=n.parent().siblings("label"),e=n.parents("form"),i.css({marginLeft:t.outerWidth()}),n.css({width:e.width()-t.outerWidth()})}),Te},fe=function(){return $("#cscf").length&&(console.log("form exists"),$("#cscf_name").attr("placeholder","Name:").show(),$("#cscf_email").attr("placeholder","Email:").show(),$("#cscf_message").attr("placeholder","Message:").show(),$("#cscf_SubmitButton").attr("value","Submit").show()),fe},re=function(){var e;return e=$(".popup .video-positioner").add(".home .excerpt_video .video-positioner").add(".slideshow .video-positioner").add(".touch .project-overview .video-positioner").add(window.backgroundImages),raf(function(){return c(oe,e)}),re},c=function(e,t){return $.each(t,function(t,n){return e(n)})},oe=function(e,t){var n,i,o,r,a,s,c,l,d,u,h,f,p;return null==t&&(t={}),n=$(e),u=n.data("ratio"),r=Q()&&$(".is-small").length?!1:n.data("full-bleed"),l=n.largeImagePadding(),O()?(p=Math.max(C(),1120),h=y()):(d=T("project-images")?".image":Q()?".image":".block",o=n.parents(d),p=o.outerWidth(),h=o.outerHeight()),r?(f=p,a=f/u,h>a&&(a=h,f=a*u)):(s=h-2*l.y,c=p-2*l.x,f=c,a=f/u,a>s&&(a=s,f=a*u)),n.css({position:"absolute",top:"50%",left:"50%",marginLeft:-f/2,marginTop:-a/2,height:a,width:f}),X()&&!r?(i=$(this).backgroundCaption(),i.css({position:"absolute",top:"50%",bottom:"auto",marginTop:a/2+m()/2,textAlign:"center"})):void 0},$.fn.largeImagePadding=function(){var e,t,n;return Q()&&$(".is-small").length?{x:v(),y:0}:X()?(n=L()?V()?4.5:3.5:2.5,{x:v(),y:v()+m()*n}):(e=$(this).backgroundCaption(),t=Math.max(m(),e.height()),{x:v(),y:v()+m()+t})},$.fn.backgroundCaption=function(){return N()?$(this).parents(".block-inner").find("h1"):$(this).parents(".image").find(".caption")},r=function(){return raf(function(){return $(".block").each(function(e,t){return $(t).calculateExcerpt()})})},Ee=function(){return $(".block").click(function(e){if(e.preventDefault(),N()){if(!$(e.target).hasClass("slideshow-nav"))return e.clientX>.5*$(window).width()?D():ee()}else if(!$(e.target).hasClass("slideshow-nav")&&!$("body").hasClass("contents-hidden"))return e.clientX>.5*$(window).width()?D():ee()})},G=function(){return $(".images .image").openPopup()},J=function(){var e;return e=$(".video-player"),e.each(function(e,t){var n,i;return n=$(t),i=n.offset().top,n.play()}),J},K=function(){var e;return e=$(".video-player"),e.each(function(e,t){var n,i;return n=$(t),i=n.offset().top,i>window.scrollTop-n.outerHeight()&&i<window.scrollTop+2*$window.height()?n.play():n.pause()}),console.log("play visible videos"),K},P=function(){var e;return e=$("table"),$('<div class="liberated-blocks">').append(e.find(".block").clone()).insertBefore(e)},q=function(){return $(".block.expanded").each(function(){var e,t,n,i,o;return e=$(this),e.find(".related, article").remove(),e.removeClass("expanded"),i=e.find(".images"),n=i.find(".image:first-child"),n.hasClass("video")?(o=n.find(".video-player"),e.addClass("excerpt_video")):(t=n.find("img"),o=$('<div class="background"></div>').attr("data-full-bleed",t.attr("data-full-bleed")).attr("data-ratio",t.attr("data-ratio")).attr("data-image",t.attr("src")),e.addClass("excerpt")),i.replaceWith(o)})},z=function(){return $(".images").insertAfter($(".text h1").first())},M=function(){var e;return e=b(),e.hasClass("do-blur")?void e.data("hold",!0):e.is(":visible")?(n("loaded",{html:!0}),e.trigger("loaded"),e.stop().fadeOut(400),$(".video-player.should-play").parent().showMedia()):void 0},Me=function(){var e,t;return t=b(),e=p().find(".background").first().clone(),t.find(".headline").mouseenter(function(){return t.addClass("do-blur")}).mouseleave(function(){return t.removeClass("do-blur"),t.data("hold")?M():void 0}),e.length&&(e.css({opacity:0}),t.toggleClass("white-text",e.parents(".block").hasClass("white")),t.prepend(e),t.imagesLoaded(function(){return e.fadeTo(400,1)})),setTimeout(M,4e3),t.click(M),raf(function(){return t.show(),S(),UTIL.loadEvents()})},i=function(e,t){return b().length?b().on("loaded",function(){return setTimeout(e,t)}):e()},A=function(){return!!b().length&&!W()},W=function(){return null!=$.cookie("loader_shown")},S=function(){return $.cookie("loader_shown",!0)},_e=function(){return j()&&$("table .block").hide().css({width:$("table").width()/2}).show(),_e},Ie=function(){var e,t,i,o,r,a;for(n("flash-video",{html:!0}),t=function(){return N()?($(".block.excerpt_video").active().showMedia(),$(".block.expanded .image:visible").showMedia()):T("post-type-archive-project")?K():$(".image").active().showMedia()},r=[1e3,2e3,4e3],a=[],i=0,o=r.length;o>i;i++)e=r[i],a.push(setTimeout(t,e));return a},X=function(){return Modernizr.touch},O=function(){return!Modernizr.touch},Y=function(){return X()&&screen.width>600},N=function(){return T("home")},E=function(){return null!=window.chrome},R=function(){return/firefox/i.test(navigator.userAgent)},j=function(){return!!(window.orientation%180)},L=function(){return!j()},V=function(){return screen.availWidth<400},Q=function(){return X()&&T("project-overview")},Le=function(e,t,n){var i,o;return null==t&&(t=100),o=void 0,i=void 0,function(){var r,a,s;return a=n||this,s=+new Date,r=arguments,o&&o+t>s?(clearTimeout(i),i=setTimeout(function(){return o=s,raf(e.bind(a))},t)):(o=s,raf(e.bind(a)))}},m=function(){return parseInt(g().css("line-height"))},v=function(){return window.$bodyPadding||(window.$bodyPadding=$("#body-padding")),parseInt(window.$bodyPadding.css("height"))},C=function(){return X()?L()?screen.availWidth:screen.availHeight:$window.width()},y=function(){return X()?L()?screen.availHeight:screen.availWidth:$window.height()},p=function(){return window.$blocks=$($(".block").get().reverse()),window.$blocks},g=function(){return window.$body||(window.$body=$("body")),window.$body},w=function(){return window.$_html||(window.$_html=$("html")),window.$_html},b=function(){return window.$_loader||(window.$_loader=$("#loader")),window.$_loader},ne=function(){return b().remove(),delete window.$_loader},T=function(e,t){return null==t&&(t={}),k(t).hasClass(e)},ze=function(e,t,n){return null==n&&(n={}),k(n).toggleClass(e,t)},n=function(e,t){return null==t&&(t={}),k(t).addClass(e)},ie=function(e,t){return null==t&&(t={}),k(t).removeClass(e)},We=function(e){return ze("white-text",e)},Ae=function(e){return We(e.hasClass("white"))},k=function(e){return null==e&&(e={}),e.html?w():g()},$.fn.activate=function(){return $(this).addClass("active")},$.fn.deactivate=function(){return $(this).removeClass("active")},$.fn.isActive=function(){return $(this).hasClass("active")},$.fn.active=function(){return $(this).filter(".active")},$.fn.inactive=function(){return $(this).not(".active")},$.fn.createMedia=function(){return $(this).eachVideo(s)},$.fn.showMedia=function(){var e,t;return e=$(this),t=e.find(".video-player"),t.each(function(e,t){var n;return n=$(t),n.sizeMedia(),N()&&!T("loaded",{html:!0})?n.addClass("should-play"):n.play()}),e},$.fn.sizeMedia=function(){var e,t,n,i,o;return t=$(this),e=t.find(".video-positioner"),o=e.data("ratio"),i=t.parents(".popup").length||t.parents(".slideshow").length||Q()||N()&&t.parents(".excerpt_video").length,t.toggleClass("inline-video",!i),n=e.data("poster"),i?e.css({paddingTop:""}):e.css({paddingTop:""+100/o+"%",width:"100%",height:0,position:"",height:"",margin:"",top:"",left:"",backgroundImage:'url("'+n+'")'})},$.fn.hideMedia=function(){var e,t;return e=$(this),t=e.find(".video-player"),t.each(function(e,t){return $(t).pause()}),e},$.fn.eachVideo=function(e){var t,n,i,o,r;for(t=$(this),r=t.find(".video-player").get(),i=0,o=r.length;o>i;i++)n=r[i],e(n);return t},$.fn.play=function(){var e,t,n,i;if(e=$(this),i=e.data("videojs"),n=e.data("play-sound"),null!=i?i.hasLoaded:void 0)try{return i.ready(function(){return"Flash"===this.techName&&(e.hasClass("is-loaded")||i.one("loadeddata",function(){return setTimeout(function(){return raf(function(){return e.addClass("is-loaded")})},50)}),this.muted(!n)),this.play()})}catch(o){t=o}},$.fn.pause=function(){var e;return e=$(this).data("videojs"),(null!=e?e.hasLoaded:void 0)?e.ready(function(){return this.pause()}):void 0},s=function(e){var t,n,i;if("undefined"!=typeof videojs&&null!==videojs)return n=$(e),i=n.data("videojs"),null==i&&(i=videojs(n.find("video").get(0)),i.volume(n.data("play-sound")?1:0),i.controls(!1),X()?(i.height(1),i.width(1)):(i.height("100%"),i.width("100%")),i.ready(function(){return this.hasLoaded=!0}),$(i.el()).addClass("vjs-player"),t=n.find(".play-button"),t.on("click",function(e){return e.stopPropagation(),e.preventDefault(),i.hasLoaded?(i.play(),i.requestFullscreen()):void 0}),n.sizeMedia(),n.data("videojs",i)),i},$.fn.backgroundFrom=function(e){var t,n,i;return window.backgroundImages||(window.backgroundImages=[]),t=$(this),i=e.data("image")||e.attr("src"),t.find("img").length?void 0:(n=$("<img>",{src:i,"class":"background-image"}),n.attr("data-ratio",e.data("ratio")),n.attr("data-full-bleed",e.data("full-bleed")),n.css({display:"block"}),n.appendTo(t),backgroundImages.push(n),e.css({display:""}),oe(n),t)},$.fn.setupBackgrounds=function(){return $(this).each(function(e,t){var n;return n=$(t).find(".background"),n.backgroundFrom(n)})},$.fn.currentFromOffset=function(e){var t,n,i;return null==e&&(e={}),n=null,t=$(this),i=e.hold||(e.hold=0),t.each(function(e,o){var r,a,s;if(r=$(o),s=r.offset().top,a=v(),i>0){if(s<=window.scrollTop+a&&s+r.height()+i>=window.scrollTop-a||s>=window.scrollTop&&e===t.length-1)return n=r,!1}else if(N()&&(a+=$window.height()/2),s<=window.scrollTop+a||e===t.length-1)return n=r,!1}),n},$.fn.currentFromMousePosition=function(e,t){var n,i,o;return null==t&&(t={}),n=$(this),!(null!=e&&n.length>1)||N()&&b().is(":visible")?null!=t["default"]?n.eq(t["default"]):n.first():(o=e.pageX-$window.scrollLeft(),i=$window.width()/n.length,n.eq(Math.min(n.length-1,Math.floor(o/i))))},$.fn.setCurrent=function(e){return setTimeout(function(){return $(".block-init").removeClass("block-init")},500),e.isActive()?void 0:($(this).not(e).deactivate().trigger("deactivate"),e.activate().trigger("activate"))},Se="is-swiping",$.fn.hasTransitionClass=function(){return $(this).hasClass(Se)},$.fn.addTransitionClass=function(){var e;return e=$(this),e.hasClass(Se)?void 0:e.addClass(Se)},$.fn.removeTransitionClass=function(){return $(this).removeClass(Se)},$.fn.makeSlideshow=function(e){var t,n,i,o,r,a;return null==e&&(e={}),t=$(this),r='<div data-role="none" class="previous">Previous</div>',o='<div data-role="none" class="next">Next</div>',i=function(e){return function(){return $(e).addTransitionClass()}}(this),n=function(){var e;return e=this.$slides.eq(this.currentSlide),Q()||Ae(e),this.$slider.removeTransitionClass(),he()},a={arrows:!0,dots:!1,infinite:!1,slide:e.items||".image",prevArrow:r,nextArrow:o,onAfterChange:n},t.slick(a).on("touchmove.slick",i).on("click",".previous:not(.slick-disabled)",i).on("click",".next:not(.slick-disabled)",i).find(".previous, .next").css({display:""}),Q()||Ae(t.find(".slick-active")),he(),t},$.fn.openPopup=function(e){var t,r,a,s,c;return null==e&&(e={}),$(".popup").length?void 0:(setTimeout(function(){return Ee()},500),a=$(".image"),t=$(".image").eq(e.selectImage),a.not(t).deactivate(),a.active().showMedia(),a.inactive().hideMedia(),c=$(this),r=c.parents(".images"),a=r.find(".image"),$("body").hasClass("page")&&(r=c.parents(".page-slideshow"),a=r.find(".thumbnail")),a.addCounters(),a.setupBackgrounds(),X()?(r.addClass("slideshow"),a.each(function(e,t){var n;return n=$(t),n.activate(),n.showMedia()}),s=r.find(".container"),s.makeSlideshow(),re()):($window.on("mousewheel",B),o(),$(".block-slideshow .block").first().addClass("active"),$(".block-slideshow .block").setupBackgrounds(),I(),i(function(){return $(".prev-image").on("click",ee),$(".next-image").on("click",D),console.log("init slideshow"),J()},1e3),r.addClass("popup"),n("contents-hidden")),he())},$.fn.fanImages=function(e){var t,n,i,o,r;return null==e&&(e={}),n=$(this),t=i=n.parents(".images"),T("project-overview")&&(o=window.scrollTop,$(".menu-images").activate(),$(".menu-overview").deactivate().click(function(e){return e.preventDefault(),$(".menu-overview").activate(),$(".menu-images").deactivate(),i.unbind("mousemove"),i.removeClass("popup"),i.hideMedia().show(),$window.unbind("scroll.popup"),ie("blur-content"),ie("contents-hidden"),$(".wrap").css({height:""}),$window.scrollTop(o),$window.trigger("scroll"),$window.trigger("resize")})),r=function(i){var o,a,s;if(o=n.currentFromMousePosition(i,{"default":e.currentIndex}),!o.isActive()){s=o.hasClass("white"),n.setCurrent(o),t.toggleClass("white-text",s),We(s);try{o.showMedia(),n.not(o).hideMedia()}catch(c){a=c}re()}return r},$window.on("scroll.popup",u),setTimeout(function(){return t.on("mousemove",r)},200),r()},$.fn.addCounters=function(){var e;return e=$(this),e.length>1?e.each(function(t,n){var i,o;return o='<div class="counter">'+(t+1)+"/"+e.length+"</div>",i=$(n).find(".caption-inner")}):void 0},$.fn.openHref=function(){var e;return e=$(this).data("href"),null!=e?window.location=e:void 0},$.fn.openSelectProjects=function(){var e;return e=$(".menu-projects a").attr("href")+"/type/selected",null!=e?window.location=e:void 0},$.fn.calculateExcerpt=function(){var t,n;return t=$(this),n=t.data("excerptCalculator"),null==n&&(n=new e(t),t.data("excerptCalculator",n)),(X()||!N()||t.hasClass("active"))&&n.render(),t},$.fn.slickReinit=function(){return $(this).slickSetOption("_",!0,!0)},e=function(){function e(e){this.block=e,this.$article=this.block.find("article").first(),this.$images=this.block.find(".images .image"),this.$related=this.block.find(".related_post"),$window.on("resize",this.render.bind(this)),this.block.on("activate",this.render.bind(this)),X()&&$window.on("orientationchange",this.render.bind(this))}return e.prototype.render=function(){return raf(function(e){return function(){var t,n;return n=e.getTargetHeight(),t=e.approximateWidth(),(e.currentHeight!==n||e.currentWidth!==t)&&(e.$article.length&&e.truncateArticle(n,t),e.$images.length&&e.truncateImages(n,t),e.$related.length&&e.truncateRelated(n,t)),e.$images.filter(":visible").showMedia(),e.$images.not(":visible").hideMedia(),e.currentHeight=n,e.currentWidth=t}}(this))},e.prototype.truncateArticle=function(e,t){var n,i,o,r,a,s,c,l,d,u;if(X()&&(e-=this.block.find("h1").outerHeight(!0)),O()&&N()&&(e-=2*m()),this.paragraphs||(this.paragraphs=this.getParagraphs()),o=!1,this.$article.empty(),e>m()){for(d=this.paragraphs,a=0,c=d.length;c>a;a++)if(i=d[a],n=i.el.clone(),this.$article.append(n),this.$article.height()>e){for(n.empty(),u=i.words,s=0,l=u.length;l>s;s++)if(r=u[s],n.append(r.clone()," "),this.$article.height()>e){o=!0;break}break}return o&&(n.find("> span:last-child").remove(),n.find("> span:last-child").remove(),n.find("> span").length&&n.append("<span>[&hellip;]</span>")),this.$article.html(this.$article.html())}},e.prototype.truncateImages=function(e,t){var n,i,o,r,a,s,c;for(e+=m()*(null!=(a=X())?a:{1:3}),this.$images.hide(),s=this.$images,c=[],o=0,r=s.length;r>o;o++){if(i=s[o],n=$(i),n.show(),this.imagesHeight()>e){n.hide();break}c.push(void 0)}return c},e.prototype.imagesHeight=function(){return this.$imagesContainer||(this.$imagesContainer=this.block.find(".images")),this.$imagesContainer.height()},e.prototype.truncateRelated=function(e,t){var n,i,o,r,a,s;for(e+=3*m(),this.$related.hide(),a=this.$related,s=[],o=0,r=a.length;r>o;o++){if(i=a[o],n=$(i),n.showMedia().show(),this.relatedHeight()>e){n.hideMedia().hide();break}s.push(void 0)}return s},e.prototype.relatedHeight=function(){return this.$relatedContainer||(this.$relatedContainer=this.block.find(".related")),this.$relatedContainer.height()},e.prototype.getTargetHeight=function(){var e,t,n;return X()&&(this.block.hasClass("writing")||this.block.hasClass("expanded"))?(e=parseInt(this.block.css("max-height")),e||(e=this.block.height()),e-2*m()):(t=3*v()+3*m()-5,n=$window.height(),n-t-n%m())},e.prototype.getParagraphs=function(){var e;return e=[],this.$article.find("p").each(function(t){return function(n,i){var o;return o=t.getWords(i),i=$(i).clone(),e.push({el:i,words:o})}}(this)),e},e.prototype.getWords=function(e){var t,n,i,o,r;for(o=this.getText(e).split(" "),r=[],n=0,i=o.length;i>n;n++)t=o[n],r.push(this.makeWord(t));return r},e.prototype.getText=function(e){return $.trim($(e).text())},e.prototype.makeWord=function(e){return $("<span>").html(e.replace(/SO\u2013IL/,'<span class="wordmark">SO<span class="hyphen">&ndash;</span>IL</span>'))},e.prototype.approximateWidth=function(){var e;return e=this.$article.width(),e-e%10},e}()}).call(this);