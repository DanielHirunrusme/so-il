(function(){var e,t,n,i,o,r,a,s,c,l,d,u,h,f,p,g,w,v,m,b,k,y,C,x,T,M,I,j,_,L,P,H,W,q,z,A,N,S,U,B,D,F,E,O,R,X,Q,V,Y,G,J,K,Z,ee,te,ne,ie,oe,re,ae,se,ce,le,de,ue,he,fe,pe,ge,$e,we,ve,me,be,ke,ye,Ce,xe,Te,Me,Ie,je,_e,Le,Pe,He,We,qe,ze,Ae,Ne,Se,Ue,Be;window.raf=window.requestAnimationFrame,jQuery.browser.mobile&&!Modernizr.touch&&(Modernizr.touch=!0,jQuery("html").removeClass("no-touch").addClass("touch")),function(e){var a;window.scrollTop=0,window.$window=e(window),a={common:{init:function(){if(Y()&&z(),Y()&&V()&&A(),G()&&N(),n(R()?"on-chrome":"not-chrome",{html:!0}),e(".content").createMedia(),$window.scroll(je(be())),$window.resize(se()),$window.resize(ye()),e(window).lazyLoadXT(),h(),Ne(),Be(),Q())return Te()},desktop:function(){return $window.scroll(g()),e("body").hasClass("project-overview")||($window.scroll(je(pe())),$window.resize(pe())),Ae()},mobile:function(){return e(".block h1,\n.block h2,\n.block h3,\n.block h4,\n.block h5,\n.block h6,\n.block article p,\n.block article p a,\n.block article p em,\n.block article blockquote,\n.block article li,\n.footnote,\n.related").hyphenate("en-us")},post:function(){return se(),raf(function(){return n("js-finished",{html:!0})})}},post_type_archive_project:{desktop:function(){return $window.scroll(je(ee()))},mobile:function(){return $window.on("orientationchange",Ie())}},home:{init:function(){},desktop:function(){return $window.scroll(f),$window.on("mousewheel",F),ge(),r(),o(),ie(),e(".block").on("click",Ue),e(".block").setupBackgrounds(),i(function(){return e(".prev-image").on("click",ne),e(".next-image").on("click",O),P(),Z()},1e3)},mobile:function(){return e(".block.writing").remove(),e(".block-slideshow").makeSlideshow({items:".block"}),e(".block").setupBackgrounds()}},project_overview:{desktop:function(){return console.log("project overview"),$window.resize(me()),$window.scroll(we()),ze(),de(),e(".close").on("click",K)},mobile:function(){return e(".image").setupBackgrounds().addCounters().find("img").click(function(){var t,n,i,o;if(e(".images").hasClass("is-small")&&!e(".images .container").hasTransitionClass())return i=e(".text .inner > h1, .text .inner > article, .related"),o=e(".images"),n=o.find(".container"),t=e(".banner"),i.hide(),o.removeClass("is-small"),t.css({position:"absolute"}),raf(function(){return n.css({visibility:"hidden"}),n.slickReinit(),se(),raf(function(){return n.css({visibility:""})})}),e(".menu-images").activate(),e(".menu-overview").deactivate().click(function(r){return r.preventDefault(),e(".menu-overview").activate(),e(".menu-images").deactivate(),i.show(),o.addClass("is-small"),t.css({position:""}),raf(function(){return n.css({visibility:"hidden"}),n.slickReinit(),se(),raf(function(){return n.css({visibility:""})})})})}),e(".images").addClass("is-small").addClass("should-show"),e(".images .container").makeSlideshow({items:".image"})}},project_images:{init:function(){return e(".block").on("click",Ue),console.log("desktop")},desktop:function(){return $window.scroll(f),$window.on("mousewheel",F),ge(),r(),o(),e(".block").setupBackgrounds(),i(function(){return e(".prev-image").on("click",ne),e(".next-image").on("click",O),console.log("init slideshow"),P(),Z()},1e3)},mobile:function(){return e(".block.writing").remove(),e(".block-slideshow").makeSlideshow({items:".block"}),e(".block").setupBackgrounds()}},single_writing:{desktop:function(){return $window.resize(w())}},page:{desktop:function(){var n,i,o,r;for(n=0,i=0,o=(r=e("figure")).length;i<o;i++)r[i].setAttribute("data-id",n),n++;return e("body").hasClass("contact")?he():(console.log("set current footnote"),t(),Se())},mobile:function(){}},post_type_archive:{desktop:function(){return console.log("this is the news archive"),console.log("set current footnote")}},search:{init:function(){return e(".menu-search").activate()}},contact:{init:function(){return console.log("init"),he()}}},window.UTIL={fire:function(e,t,n){var i;if(i=a,t=null==t?"init":t,""!==e&&i[e]&&"function"==typeof i[e][t])return i[e][t](n)},loadEvents:function(){var e,t,n,i;for(UTIL.fire("common"),X()&&UTIL.fire("common","desktop"),Y()&&UTIL.fire("common","mobile"),t=0,n=(i=document.body.className.replace(/-/g,"_").split(/\s+/)).length;t<n;t++)e=i[t],UTIL.fire(e),X()&&UTIL.fire(e,"desktop"),Y()&&UTIL.fire(e,"mobile");return UTIL.fire("common","post")},load:function(){return X()&&U()?xe():(oe(),n("loaded",{html:!0}),UTIL.loadEvents())}},e(document).ready(UTIL.load)}(jQuery),Le=0,_e=0,q=[],l=[null,null,null,null,null,null,null,null,null],D=0,I=function(){return D>0?(D-=.38,!1):null!==l[0]&&(l[0]<l[4]&&l[1]<=l[4]&&l[2]<=l[4]&&l[3]<=l[4]&&l[5]<=l[4]&&l[6]<=l[4]&&l[7]<=l[4]&&l[8]<l[4]&&I)},u=function(e){return e.deltaY<0?O():ne()},F=function(e){var t;return e.preventDefault(),t=0,t="mousewheel"===e.type?-1*e.originalEvent.wheelDeltaY:40*e.originalEvent.detail,console.log("delta "+t),I()?(D=10,u(e)):null!==l[8]&&120!==l[8]||120!==Math.abs(t)||u(e),l.shift(),l.push(Math.abs(t)),F},be=function(){return window.scrollTop=$window.scrollTop(),be},g=function(){var e,t;return window.$sticky||(window.$sticky=$(".sticky-container")),window.stickyTop||(window.stickyTop=parseInt($(".sticky-container").css("top"))),!!$sticky.length&&(t=Math.max(0,$window.scrollTop()),e=Math.max(0,$window.scrollLeft()),Math.max(y(),stickyTop-t),-Math.min(parseInt($("body").css("min-width"))-$window.width(),e),g)},w=function(){return window.stickyTop=$("article").position().top,g(),w},f=function(){var e,t;return t=Math.max(0,$window.scrollLeft()),e=-Math.min(parseInt($("body").css("min-width"))-$window.width(),t),v().css({marginLeft:Math.min(0,e)}),f},p=function(){var e,t;return t=Math.max(0,$window.scrollLeft()),e=-Math.min(parseInt($("body").css("min-width"))-$window.width(),t),$(".popup .image, .project-images .banner").css({marginLeft:Math.min(0,e)}),f},o=function(){return $(document).keydown(function(e){switch(e.stopPropagation(),e.which){case 37:ne();break;case 39:O()}return e.preventDefault()}),o},pe=function(){var e;return $(".popup").length||V()||j("project-images")||null==(e=v().currentFromOffset())||e.isActive()||(v().setCurrent(e),qe(e),$(".images .image").deactivate()),pe},K=function(e){return $("body").hasClass("contents-hidden")&&($("body").removeClass("contents-hidden"),$(".images").removeClass("popup"),$(".block").removeClass("active block-init"),$(window).off("mousewheel"),$(".block").off("click",Ue),$("body").trigger("scroll"),$(".background-image").css("display",""),a(),e.preventDefault()),K},O=function(){return Me(),E(),O},ne=function(){return Me(),te(),ne},E=function(){var e,t,n;return console.log("========="),console.log("%c[next Image]","color:blue"),t=$(".image.block"),e=$(".image.block.active"),n="",n=e.index()<$(".image.block").length-1?$(".image.block").eq(e.index()+1):$(".image.block").eq(0),t.setCurrent(n),ue(),E},te=function(){var e,t,n;return console.log("prev Image"),t=$(".image.block"),e=$(".image.block.active"),n="",n=e.index()>0?$(".image.block").eq(e.index()-1):$(".image.block").eq($(".image.block").length-1),console.log(n),t.setCurrent(n),ue(),te},P=function(){if(!$("body").hasClass("contents-hidden"))return P},a=function(){return clearInterval(Le),clearTimeout(_e)},Me=function(){return clearInterval(Le),clearTimeout(_e),_e=setTimeout(function(){return Le=setInterval(E,6e3)},12e3),Me},ge=function(e){var t,n;return n=$(".block"),t=n.currentFromMousePosition(e),n.setCurrent(t),qe(t),t.hasClass("excerpt_video")&&t.showMedia(),n.not(t).hideMedia(),ge},ce=function(){var e,t,n,i;return e=$(".banner").position().top+$(".banner").height(),i=Number($(".content").css("padding-right").split("px").join("")),$(".overview-block .text").css("width",.444*$("body").outerWidth()-i/2),e+$(".overview-block .text").height()<$(window).height()?$(window).scrollTop()>e?($("body")[0].scrollHeight-$window.height(),t=$(window).scrollTop(),t-e,$(".overview-block .text").addClass("sticky").removeClass("fixed")):$(".overview-block .text").removeClass("sticky"):(n=Number($(".content").css("padding-bottom").split("px").join("")),$(window).scrollTop()>e+$(".overview-block .text").height()-$(window).height()+2*n&&!$(".container").hasClass("fixed")?$(".overview-block .text").addClass("fixed").removeClass("sticky"):$(".overview-block .text").removeClass("fixed"))},le=function(){var e,t,n,i;return t=$(".banner").position().top+$(".banner").height(),i=Number($(".content").css("padding-right").split("px").join("")),Number($(".overview-block .text .inner").css("padding-right").split("px").join("")),$(".related-right").css("width",.222*$("body").outerWidth()-i/2),t+$(".related-right .inner").height()<$(window).height()?$(window).scrollTop()>t?(e=$(".content").outerWidth()-$(".related-right").width()-1,$(".related-right").addClass("sticky").removeClass("fixed").css("left",e)):$(".related-right").removeClass("sticky").css("left",""):(n=Number($(".content").css("padding-bottom").split("px").join("")),console.log($(window).scrollTop()),console.log(t+$(".related-right .inner").height()-$(window).height()+n),$(window).scrollTop()>t+$(".related-right .inner").height()-$(window).height()+2*n?(e=$(".content").outerWidth()-$(".related-right").width()-1,$(".related-right").addClass("fixed").css("left",e).removeClass("sticky")):$(".related-right").removeClass("fixed").css("left",""))},de=function(){var e,t,n,i;if($(".sticky-container .related").height()+$(".sticky-container").position().top>$window.height())return e=($('.content[role="document"]').outerHeight()-$('.content[role="document"]').height())/2,t=$("body")[0].scrollHeight-$window.height(),n=$("body").scrollTop(),console.log(e),i=n/t*($(".sticky-container .related").height()-$window.height()+e),i=-i,void $(".sticky-container .related").css({"-webkit-transform":"translate(0px,"+i+"px)"})},me=function(){var e,t,n;for(we(),$("body").trigger("scroll"),t=$("body")[0].scrollHeight,n=$(".image").last().data("unique-set")+1,console.log("totalImages "+n),$(".images").activate(),q=[],e=1;e<=n;)q.push(t/e-$window.height()/n),e++;return q.reverse(),me},ke=function(){return ke},ve=function(){return $(".sticky-container").removeClass("all-visible"),$(".popup").length||raf(function(){var e,t,n,i;for(n=$(".image"),e=0,i=0;i<q.length;)$("body").scrollTop()>=q[i]&&(e=i),i++;return $("body").scrollTop()>=$("body")[0].scrollHeight-$window.height()?e=q.length-1:$("body").scrollTop()<=q[1]&&(e=0),(t=$(".image[data-unique-set="+e+"]")).hasClass("active")?we:(n.not(t).deactivate(),t.each(function(){$(this).activate()}),n.active().showMedia(),n.inactive().hideMedia())}),ve},fe=function(){var e,t,n,i,o;return $(".sticky-container").addClass("all-visible"),n=Number($(".content").css("padding-bottom").split("px").join("")),i=Number($(".content").css("padding-right").split("px").join("")),t=Number($(".overview-block .text .inner").css("padding-right").split("px").join("")),console.log("pb "+i),o=$(".overview-block .sticky-container .container").height()+$(".overview-block").position().top-$(window).height()+4*n,$(".overview-block .sticky-container .container").css("width",.333*$("body").outerWidth()-t),console.log(o),console.log($("body").scrollTop()),$(window).scrollTop()>o?(e=$(".overview-block .text").width()+1.5*t,$(".overview-block .sticky-container .container").addClass("fixed").css("left",e)):$(".overview-block .sticky-container .container").removeClass("fixed").css("left",""),fe},we=function(){return fe(),le(),ce(),ke(),we},$e=function(){return window.$footnotes||(window.$footnotes=$($(".footnote").get().reverse())),de(),$(".popup").length||raf(function(){var e,t,n,i;for(n=$(".image"),t=0,i=0;i<q.length;)$("body").scrollTop()>=q[i]&&(t=i),i++;return $("body").scrollTop()>=$("body")[0].scrollHeight-$window.height()?t=q.length-1:$("body").scrollTop()<=q[1]&&(t=0),e=$(".image").eq(t),n.not(e).deactivate(),e.activate(),n.active().showMedia(),n.inactive().hideMedia()}),$e},h=function(){if($("#menu-projects-sub-navigation").length&&$(".menu-projects").activate(),$("#menu-research-sub-navigation").length&&$(".menu-research").activate(),$("#menu-information-sub-navigation").length&&$(".menu-info").activate(),j("post-type-archive-project"))return $(".menu-archive").activate()},ue=function(){var e,t,n;return console.log("set captions"),t=$(".block.active"),e=$("body"),n=t.hasClass("white"),e.toggleClass("white-text",n),We(n),$(".description").dotdotdot({ellipsis:" [...]",watch:"window"}),$(".description").off("mouseenter mouseleave",Pe),$(".description.is-truncated").on("mouseenter",Ce).on("mouseleave",_)},Ce=function(e){return e.stopPropagation(),$(".block.active .description").addClass("expanded"),$(".block.slick-active .description").addClass("expanded"),$(".block.active .description").trigger("destroy"),$(".block.slick-active .description").trigger("destroy"),console.log("show caption")},_=function(e){return e.stopPropagation(),$(".block.active .description").removeClass("expanded"),$(".block.slick-active .description").removeClass("expanded"),console.log("hide caption"),$(".description").dotdotdot({ellipsis:" [...]",watch:"window"})},Pe=function(e){return e.stopPropagation(),$(".block.active .description").toggleClass("expanded"),$(".block.slick-active .description").toggleClass("expanded"),$(".block.active .description").hasClass("expanded")&&$(".block.active .description").hasClass("is-truncated")?(console.log("destroy elips"),$(".block.active .description").trigger("destroy")):$(".description").dotdotdot({ellipsis:" [...]",watch:"window"}),$(".block.slick-active .description").hasClass("expanded")&&$(".block.slick-active .description").hasClass("is-truncated")?(console.log("destroy elips"),$(".block.slick-active .description").trigger("destroy")):$(".description").dotdotdot({ellipsis:" [...]",watch:"window"}),Me()},t=function(){return $(".page-slideshow img").each(function(){return $(this).addClass("thumbnail")})},ie=function(){return setTimeout(function(){return re("init-slideshow"),$(".block-slideshow").removeClass("init-slideshow")},500)},s=function(){return Me(),re("contents-hidden popup"),$window.off("mousewheel")},ze=function(){return $(".images .image").on("click",function(e){if(!$(".popup").length)return $(this).openPopup({fakePage:!1,selectImage:$(e.currentTarget).index()})})},Se=function(){return $(".page-slideshow .thumbnail").length&&($("#menu-primary-navigation").append('<button class="close"><i></i></button>'),$(".close").mouseenter(function(){return n("blur-content")}),$(".close").mouseleave(function(){return re("blur-content")}),$(".close").click(function(){return s()})),$(".page-slideshow .thumbnail").on("click",function(e){var t;if(n("contents-hidden init-slideshow"),e.stopPropagation(),t=$(e.currentTarget).closest("figure").data("id"),$(".block-slideshow .block").removeClass("active"),$(".block-slideshow .block").eq(t).addClass("active"),setTimeout(function(){return re("init-slideshow")},500),!$(".popup").length)return $(this).openPopup({fakePage:!1}),n("popup");$window.on("mousewheel",F)})},Be=function(){return $(".subnav .active .controls a").click(function(e){var t,n;return e.preventDefault(),t=$(this),n=t.parents(".control-item").prevAll().length,$window.scrollTop($(".subsection").eq(n).offset().top-b())})},Ae=function(){var e;return(e=$(".main-nav a")).mouseenter(function(){return n("blur-content")}),e.mouseleave(function(){return re("blur-content")})},Ne=function(){var e;return e=$(".newsletter-form"),$(".show-newsletter-form").click(function(){return e.toggle(),ye()}),e.find(".submit").click(function(){return e.submit()})},ye=function(){return $('form input[type="text"]').each(function(){var e,t,n,i;return(n=$(this)).parents(".input-wrapper").length||n.wrap('<div class="input-wrapper">'),i=n.parents(".input-wrapper"),t=n.parent().siblings("label"),e=n.parents("form"),i.css({marginLeft:t.outerWidth()}),n.css({width:e.width()-t.outerWidth()})}),ye},he=function(){return $("#cscf").length&&(console.log("form exists"),$("#cscf_name").attr("placeholder","Name:").show(),$("#cscf_email").attr("placeholder","Email:").show(),$("#cscf_message").attr("placeholder","Message:").show(),$("#cscf_SubmitButton").attr("value","Submit").show()),he},se=function(){var e;return e=$(".popup .video-positioner").add(".home .excerpt_video .video-positioner").add(".slideshow .video-positioner").add(".touch .project-overview .video-positioner").add(window.backgroundImages),raf(function(){return d(ae,e)}),se},d=function(e,t){return $.each(t,function(t,n){return e(n)})},ae=function(e,t){var n,i,o,r,a,s,c,l,d,u,h;if(null==t&&(t={}),n=$(e),l=n.data("ratio"),o=(!G()||!$(".is-small").length)&&n.data("full-bleed"),s=n.largeImagePadding(),X()?(h=Math.max(M(),1120),d=T()):(c=j("project-images")?".image":G()?".image":".block",h=(i=n.parents(c)).outerWidth(),d=i.outerHeight()),o?(r=(u=h)/l)<d&&(u=(r=d)*l):(a=d-2*s.y,(r=(u=h-2*s.x)/l)>a&&(u=(r=a)*l)),n.css({position:"absolute",top:"50%",left:"50%",marginLeft:-u/2,marginTop:-r/2,height:r,width:u}),Y()&&!o)return $(this).backgroundCaption().css({position:"absolute",top:"50%",bottom:"auto",marginTop:r/2+y()/2,textAlign:"center"})},$.fn.largeImagePadding=function(){var e,t,n;return G()&&$(".is-small").length?{x:b(),y:0}:Y()?(n=W()?J()?4.5:3.5:2.5,{x:b(),y:b()+y()*n}):(e=$(this).backgroundCaption(),t=Math.max(y(),e.height()),{x:b(),y:b()+y()+t})},$.fn.backgroundCaption=function(){return V()?$(this).parents(".block-inner").find("h1"):$(this).parents(".image").find(".caption")},r=function(){return raf(function(){return $(".block").each(function(e,t){return $(t).calculateExcerpt()})})},Ue=function(e){if(e.stopPropagation(),e.preventDefault(),console.log(e.target),V()){if(!$(e.target).hasClass("slideshow-nav"))return e.clientX>.5*$(window).width()?O():ne()}else if(!$(e.target).hasClass("slideshow-nav"))return e.clientX>.5*$(window).width()?O():ne()},Z=function(){return $(".video-player").each(function(e,t){var n;return n=$(t),n.offset().top,n.play()}),Z},ee=function(){return $(".video-player").each(function(e,t){var n,i;return n=$(t),(i=n.offset().top)>window.scrollTop-n.outerHeight()&&i<window.scrollTop+2*$window.height()?n.play():n.pause()}),console.log("play visible videos"),ee},z=function(){var e;return e=$("table"),$('<div class="liberated-blocks">').append(e.find(".block").clone()).insertBefore(e)},A=function(){return $(".block.expanded").each(function(){var e,t,n,i,o;return(e=$(this)).find(".related, article").remove(),e.removeClass("expanded"),i=e.find(".images"),(n=i.find(".image:first-child")).hasClass("video")?(o=n.find(".video-player"),e.addClass("excerpt_video")):(t=n.find("img"),o=$('<div class="background"></div>').attr("data-full-bleed",t.attr("data-full-bleed")).attr("data-ratio",t.attr("data-ratio")).attr("data-image",t.attr("src")),e.addClass("excerpt")),i.replaceWith(o)})},N=function(){return $(".images").insertAfter($(".text h1").first())},L=function(){var e;if(!(e=C()).hasClass("do-blur"))return e.is(":visible")?(n("loaded",{html:!0}),e.trigger("loaded"),e.stop().fadeOut(400),$(".video-player.should-play").parent().showMedia()):void 0;e.data("hold",!0)},xe=function(){var e,t;return t=C(),e=v().find(".background").first().clone(),t.find(".headline").mouseenter(function(){return t.addClass("do-blur")}).mouseleave(function(){if(t.removeClass("do-blur"),t.data("hold"))return L()}),e.length&&(e.css({opacity:0}),t.toggleClass("white-text",e.parents(".block").hasClass("white")),t.prepend(e),t.imagesLoaded(function(){return e.fadeTo(400,1)})),setTimeout(L,4e3),t.click(L),raf(function(){return t.show(),B(),UTIL.loadEvents()})},i=function(e,t){return C().length?C().on("loaded",function(){return setTimeout(e,t)}):e()},U=function(){return!!C().length&&!S()},S=function(){return null!=$.cookie("loader_shown")},B=function(){return $.cookie("loader_shown",!0)},Ie=function(){return H()&&$("table .block").hide().css({width:$("table").width()/2}).show(),Ie},Te=function(){var e,t,i,o,r,a;for(n("flash-video",{html:!0}),t=function(){return V()?($(".block.excerpt_video").active().showMedia(),$(".block.expanded .image:visible").showMedia()):j("post-type-archive-project")?ee():$(".image").active().showMedia()},a=[],i=0,o=(r=[1e3,2e3,4e3]).length;i<o;i++)e=r[i],a.push(setTimeout(t,e));return a},Y=function(){return Modernizr.touch},X=function(){return!Modernizr.touch},V=function(){return j("home")},R=function(){return null!=window.chrome},Q=function(){return/firefox/i.test(navigator.userAgent)},H=function(){return!!(window.orientation%180)},W=function(){return!H()},J=function(){return screen.availWidth<400},G=function(){return Y()&&j("project-overview")},je=function(e,t,n){var i,o;return null==t&&(t=100),o=void 0,i=void 0,function(){var r,a;return r=n||this,a=+new Date,arguments,o&&a<o+t?(clearTimeout(i),i=setTimeout(function(){return o=a,raf(e.bind(r))},t)):(o=a,raf(e.bind(r)))}},y=function(){return parseInt(m().css("line-height"))},b=function(){return window.$bodyPadding||(window.$bodyPadding=$("#body-padding")),parseInt(window.$bodyPadding.css("height"))},M=function(){return Y()?W()?screen.availWidth:screen.availHeight:$window.width()},T=function(){return Y()?W()?screen.availHeight:screen.availWidth:$window.height()},v=function(){return window.$blocks=$($(".block").get().reverse()),window.$blocks},m=function(){return window.$body||(window.$body=$("body")),window.$body},k=function(){return window.$_html||(window.$_html=$("html")),window.$_html},C=function(){return window.$_loader||(window.$_loader=$("#loader")),window.$_loader},oe=function(){return C().remove(),delete window.$_loader},j=function(e,t){return null==t&&(t={}),x(t).hasClass(e)},He=function(e,t,n){return null==n&&(n={}),x(n).toggleClass(e,t)},n=function(e,t){return null==t&&(t={}),x(t).addClass(e)},re=function(e,t){return null==t&&(t={}),x(t).removeClass(e)},We=function(e){return He("white-text",e)},qe=function(e){return We(e.hasClass("white"))},x=function(e){return null==e&&(e={}),e.html?k():m()},$.fn.activate=function(){return $(this).addClass("active")},$.fn.deactivate=function(){return $(this).removeClass("active")},$.fn.isActive=function(){return $(this).hasClass("active")},$.fn.active=function(){return $(this).filter(".active")},$.fn.inactive=function(){return $(this).not(".active")},$.fn.createMedia=function(){return $(this).eachVideo(c)},$.fn.showMedia=function(){var e;return e=$(this),e.find(".video-player").each(function(e,t){var n;return(n=$(t)).sizeMedia(),V()&&!j("loaded",{html:!0})?n.addClass("should-play"):n.play()}),e},$.fn.sizeMedia=function(){var e,t,n,i,o;return t=$(this),e=t.find(".video-positioner"),o=e.data("ratio"),i=t.parents(".popup").length||t.parents(".slideshow").length||G()||V()&&t.parents(".excerpt_video").length,t.toggleClass("inline-video",!i),n=e.data("poster"),i?e.css({paddingTop:""}):e.css({paddingTop:100/o+"%",width:"100%",height:0,position:"",height:"",margin:"",top:"",left:"",backgroundImage:'url("'+n+'")'})},$.fn.hideMedia=function(){var e;return e=$(this),e.find(".video-player").each(function(e,t){return $(t).pause()}),e},$.fn.eachVideo=function(e){var t,n,i,o;for(n=0,i=(o=(t=$(this)).find(".video-player").get()).length;n<i;n++)e(o[n]);return t},$.fn.play=function(){var e,t,n;if(e=$(this),n=e.data("videojs"),t=e.data("play-sound"),null!=n?n.hasLoaded:void 0)try{return n.ready(function(){return"Flash"===this.techName&&(e.hasClass("is-loaded")||n.one("loadeddata",function(){return setTimeout(function(){return raf(function(){return e.addClass("is-loaded")})},50)}),this.muted(!t)),this.play()})}catch(e){e}},$.fn.pause=function(){var e;if(null!=(e=$(this).data("videojs"))?e.hasLoaded:void 0)return e.ready(function(){return this.pause()})},c=function(e){var t,n;if("undefined"!=typeof videojs&&null!==videojs)return t=$(e),null==(n=t.data("videojs"))&&((n=videojs(t.find("video").get(0))).volume(t.data("play-sound")?1:0),n.controls(!1),Y()?(n.height(1),n.width(1)):(n.height("100%"),n.width("100%")),n.ready(function(){return this.hasLoaded=!0}),$(n.el()).addClass("vjs-player"),t.find(".play-button").on("click",function(e){if(e.stopPropagation(),e.preventDefault(),n.hasLoaded)return n.play(),n.requestFullscreen()}),t.sizeMedia(),t.data("videojs",n)),n},$.fn.backgroundFrom=function(e){var t,n,i;if(window.backgroundImages||(window.backgroundImages=[]),t=$(this),i=e.data("image")||e.attr("src"),!t.find("img").length)return(n=$("<img>",{src:i,class:"background-image"})).attr("data-ratio",e.data("ratio")),n.attr("data-full-bleed",e.data("full-bleed")),n.css({display:"block"}),n.appendTo(t),backgroundImages.push(n),e.css({display:""}),ae(n),t},$.fn.setupBackgrounds=function(){return $(this).each(function(e,t){var n;return(n=$(t).find(".background")).backgroundFrom(n)})},$.fn.currentFromOffset=function(e){var t,n,i;return null==e&&(e={}),n=null,t=$(this),i=e.hold||(e.hold=0),t.each(function(e,o){var r,a,s;if(r=$(o),s=r.offset().top,a=b(),i>0){if(s<=window.scrollTop+a&&s+r.height()+i>=window.scrollTop-a||s>=window.scrollTop&&e===t.length-1)return n=r,!1}else if(V()&&(a+=$window.height()/2),s<=window.scrollTop+a||e===t.length-1)return n=r,!1}),n},$.fn.currentFromMousePosition=function(e,t){var n,i,o;return null==t&&(t={}),n=$(this),!(null!=e&&n.length>1)||V()&&C().is(":visible")?null!=t.default?n.eq(t.default):n.first():(o=e.pageX-$window.scrollLeft(),i=$window.width()/n.length,n.eq(Math.min(n.length-1,Math.floor(o/i))))},$.fn.setCurrent=function(e){if(setTimeout(function(){return $(".block-init").removeClass("block-init")},500),!e.isActive())return $(this).not(e).deactivate().trigger("deactivate"),e.activate().trigger("activate")},$.fn.hasTransitionClass=function(){return $(this).hasClass("is-swiping")},$.fn.addTransitionClass=function(){var e;if(!(e=$(this)).hasClass("is-swiping"))return e.addClass("is-swiping")},$.fn.removeTransitionClass=function(){return $(this).removeClass("is-swiping")},$.fn.makeSlideshow=function(e){var t,n,i,o,r,a;return null==e&&(e={}),t=$(this),r='<div data-role="none" class="previous">Previous</div>',o='<div data-role="none" class="next">Next</div>',i=function(e){return function(){return $(e).addTransitionClass()}}(this),n=function(){var e;return e=this.$slides.eq(this.currentSlide),G()||qe(e),this.$slider.removeTransitionClass(),ue()},a={arrows:!0,dots:!1,infinite:!1,slide:e.items||".image",prevArrow:r,nextArrow:o,onAfterChange:n},t.slick(a).on("touchmove.slick",i).on("click",".previous:not(.slick-disabled)",i).on("click",".next:not(.slick-disabled)",i).find(".previous, .next").css({display:""}),G()||qe(t.find(".slick-active")),ue(),t},$.fn.openPopup=function(e){var t,r,a,s;if(null==e&&(e={}),!$(".popup").length)return $(".block").off("click",Ue),setTimeout(function(){return $(".block").on("click",Ue)},500),a=$(".image"),t=$(".image").eq(e.selectImage),a.not(t).deactivate(),a.inactive().hideMedia(),a.active().showMedia(),$(".image.block-init").removeClass("block-init"),$(".image").eq(e.selectImage).addClass("block-init active"),$(".background-image").css("display","block"),s=$(this),r=s.parents(".images"),a=r.find(".image"),$("body").hasClass("page")&&(a=(r=s.parents(".page-slideshow")).find(".thumbnail")),a.addCounters(),a.setupBackgrounds(),Y()?(r.addClass("slideshow"),a.each(function(e,t){var n;return(n=$(t)).activate(),n.showMedia()}),r.find(".container").makeSlideshow(),se()):($window.on("mousewheel",F),o(),$(".block-slideshow .block").first().addClass("active"),$(".block-slideshow .block").setupBackgrounds(),P(),i(function(){return $(".prev-image").on("click",ne),$(".next-image").on("click",O),console.log("init slideshow"),Z()},1e3),r.addClass("popup"),n("contents-hidden")),ue()},$.fn.fanImages=function(e){var t,n,i,o,r;return null==e&&(e={}),n=$(this),t=i=n.parents(".images"),j("project-overview")&&(o=window.scrollTop,$(".menu-images").activate(),$(".menu-overview").deactivate().click(function(e){return e.preventDefault(),$(".menu-overview").activate(),$(".menu-images").deactivate(),i.unbind("mousemove"),i.removeClass("popup"),i.hideMedia().show(),$window.unbind("scroll.popup"),re("blur-content"),re("contents-hidden"),$(".wrap").css({height:""}),$window.scrollTop(o),$window.trigger("scroll"),$window.trigger("resize")})),r=function(i){var o,a;if(!(o=n.currentFromMousePosition(i,{default:e.currentIndex})).isActive()){a=o.hasClass("white"),n.setCurrent(o),t.toggleClass("white-text",a),We(a);try{o.showMedia(),n.not(o).hideMedia()}catch(e){e}se()}return r},$window.on("scroll.popup",p),setTimeout(function(){return t.on("mousemove",r)},200),r()},$.fn.addCounters=function(){var e;if((e=$(this)).length>1)return e.each(function(t,n){return'<div class="counter">'+(t+1)+"/"+e.length+"</div>",$(n).find(".caption-inner")})},$.fn.openHref=function(){var e;if(null!=(e=$(this).data("href")))return window.location=e},$.fn.openSelectProjects=function(){var e;if(null!=(e=$(".menu-projects a").attr("href")+"/type/selected"))return window.location=e},$.fn.calculateExcerpt=function(){var t,n;return t=$(this),null==(n=t.data("excerptCalculator"))&&(n=new e(t),t.data("excerptCalculator",n)),(Y()||!V()||t.hasClass("active"))&&n.render(),t},$.fn.slickReinit=function(){return $(this).slickSetOption("_",!0,!0)},e=function(){function e(e){this.block=e,this.$article=this.block.find("article").first(),this.$images=this.block.find(".images .image"),this.$related=this.block.find(".related_post"),$window.on("resize",this.render.bind(this)),this.block.on("activate",this.render.bind(this)),Y()&&$window.on("orientationchange",this.render.bind(this))}return e.prototype.render=function(){return raf(function(e){return function(){var t,n;return n=e.getTargetHeight(),t=e.approximateWidth(),e.currentHeight===n&&e.currentWidth===t||(e.$article.length&&e.truncateArticle(n,t),e.$images.length&&e.truncateImages(n,t),e.$related.length&&e.truncateRelated(n,t)),e.$images.filter(":visible").showMedia(),e.$images.not(":visible").hideMedia(),e.currentHeight=n,e.currentWidth=t}}(this))},e.prototype.truncateArticle=function(e,t){var n,i,o,r,a,s,c,l,d,u;if(Y()&&(e-=this.block.find("h1").outerHeight(!0)),X()&&V()&&(e-=2*y()),this.paragraphs||(this.paragraphs=this.getParagraphs()),o=!1,this.$article.empty(),e>y()){for(a=0,c=(d=this.paragraphs).length;a<c;a++)if(i=d[a],n=i.el.clone(),this.$article.append(n),this.$article.height()>e){for(n.empty(),s=0,l=(u=i.words).length;s<l;s++)if(r=u[s],n.append(r.clone()," "),this.$article.height()>e){o=!0;break}break}return o&&(n.find("> span:last-child").remove(),n.find("> span:last-child").remove(),n.find("> span").length&&n.append("<span>[&hellip;]</span>")),this.$article.html(this.$article.html())}},e.prototype.truncateImages=function(e,t){var n,i,o,r,a,s,c;for(e+=y()*(null!=(a=Y())?a:{1:3}),this.$images.hide(),c=[],o=0,r=(s=this.$images).length;o<r;o++){if(i=s[o],(n=$(i)).show(),this.imagesHeight()>e){n.hide();break}c.push(void 0)}return c},e.prototype.imagesHeight=function(){return this.$imagesContainer||(this.$imagesContainer=this.block.find(".images")),this.$imagesContainer.height()},e.prototype.truncateRelated=function(e,t){var n,i,o,r,a,s;for(e+=3*y(),this.$related.hide(),s=[],o=0,r=(a=this.$related).length;o<r;o++){if(i=a[o],(n=$(i)).showMedia().show(),this.relatedHeight()>e){n.hideMedia().hide();break}s.push(void 0)}return s},e.prototype.relatedHeight=function(){return this.$relatedContainer||(this.$relatedContainer=this.block.find(".related")),this.$relatedContainer.height()},e.prototype.getTargetHeight=function(){var e,t,n;return Y()&&(this.block.hasClass("writing")||this.block.hasClass("expanded"))?((e=parseInt(this.block.css("max-height")))||(e=this.block.height()),e-2*y()):(t=3*b()+3*y()-5,(n=$window.height())-t-n%y())},e.prototype.getParagraphs=function(){var e;return e=[],this.$article.find("p").each(function(t){return function(n,i){var o;return o=t.getWords(i),i=$(i).clone(),e.push({el:i,words:o})}}(this)),e},e.prototype.getWords=function(e){var t,n,i,o,r;for(r=[],n=0,i=(o=this.getText(e).split(" ")).length;n<i;n++)t=o[n],r.push(this.makeWord(t));return r},e.prototype.getText=function(e){return $.trim($(e).text())},e.prototype.makeWord=function(e){return $("<span>").html(e.replace(/SO\u2013IL/,'<span class="wordmark">SO<span class="hyphen">&ndash;</span>IL</span>'))},e.prototype.approximateWidth=function(){var e;return(e=this.$article.width())-e%10},e}()}).call(this);