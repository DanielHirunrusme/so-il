(function(){var e,t,n,i,o,r,a,s,c,l,u,d,h,f,p,g,w,v,m,b,k,y,C,T,x,M,I,j,_,L,H,P,q,z,W,A,S,U,B,F,D,E,O,R,N,X,Q,V,Y,G,J,K,Z,ee,te,ne,ie,oe,re,ae,se,ce,le,ue,de,he,fe,pe,ge,$e,we,ve,me,be,ke,ye,Ce,Te,xe,Me,Ie,je,_e,Le,He,Pe,qe,ze;window.raf=window.requestAnimationFrame,jQuery.browser.mobile&&!Modernizr.touch&&(Modernizr.touch=!0,jQuery("html").removeClass("no-touch").addClass("touch")),function(e){var a;window.scrollTop=0,window.$window=e(window),a={common:{init:function(){if(R()&&H(),R()&&O()&&P(),N()&&q(),n(F()?"on-chrome":"not-chrome",{html:!0}),e(".content").createMedia(),$window.scroll(ye(pe())),$window.resize(te()),$window.resize($e()),e(window).lazyLoadXT(),l(),He(),ze(),E())return me()},desktop:function(){return $window.scroll(h()),e("body").hasClass("project-overview")||($window.scroll(ye(ce())),$window.resize(ce())),Le()},mobile:function(){return e(".block h1,\n.block h2,\n.block h3,\n.block h4,\n.block h5,\n.block h6,\n.block article p,\n.block article p a,\n.block article p em,\n.block article blockquote,\n.block article li,\n.footnote,\n.related").hyphenate("en-us")},post:function(){return te(),raf(function(){return n("js-finished",{html:!0})})}},post_type_archive_project:{desktop:function(){return $window.scroll(ye(V()))},mobile:function(){return $window.on("orientationchange",ke())}},home:{init:function(){},desktop:function(){return $window.scroll(u),$window.on("mousewheel",S),qe(),le(),r(),o(),J(),e(".block").setupBackgrounds(),i(function(){return e(".prev-image").on("click",G),e(".next-image").on("click",B),I(),Q()},1e3)},mobile:function(){return e(".block.writing").remove(),e(".block-slideshow").makeSlideshow({items:".block"}),e(".block").setupBackgrounds()}},project_overview:{desktop:function(){return console.log("project overview"),$window.resize(fe()),$window.scroll(de()),_e(),oe()},mobile:function(){return e(".image").setupBackgrounds().addCounters().find("img").click(function(){var t,n,i,o;if(e(".images").hasClass("is-small")&&!e(".images .container").hasTransitionClass())return i=e(".text .inner > h1, .text .inner > article, .related"),o=e(".images"),n=o.find(".container"),t=e(".banner"),i.hide(),o.removeClass("is-small"),t.css({position:"absolute"}),raf(function(){return n.css({visibility:"hidden"}),n.slickReinit(),te(),raf(function(){return n.css({visibility:""})})}),e(".menu-images").activate(),e(".menu-overview").deactivate().click(function(r){return r.preventDefault(),e(".menu-overview").activate(),e(".menu-images").deactivate(),i.show(),o.addClass("is-small"),t.css({position:""}),raf(function(){return n.css({visibility:"hidden"}),n.slickReinit(),te(),raf(function(){return n.css({visibility:""})})})})}),e(".images").addClass("is-small").addClass("should-show"),e(".images .container").makeSlideshow({items:".image"})}},project_images:{init:function(){return qe(),console.log("desktop")},desktop:function(){return $window.scroll(u),$window.on("mousewheel",S),le(),r(),o(),e(".block").setupBackgrounds(),i(function(){return e(".prev-image").on("click",G),e(".next-image").on("click",B),console.log("init slideshow"),I(),Q()},1e3)},mobile:function(){return e(".block.writing").remove(),e(".block-slideshow").makeSlideshow({items:".block"}),e(".block").setupBackgrounds()}},single_writing:{desktop:function(){return $window.resize(f())}},page:{desktop:function(){return console.log("this is a page"),e("body").hasClass("contact")?ae():(console.log("set current footnote"),t(),Pe())},mobile:function(){}},post_type_archive:{desktop:function(){return console.log("this is the news archive"),console.log("set current footnote")}},search:{init:function(){return e(".menu-search").activate()}},contact:{init:function(){return console.log("init"),ae()}}},window.UTIL={fire:function(e,t,n){var i;if(i=a,t=null==t?"init":t,""!==e&&i[e]&&"function"==typeof i[e][t])return i[e][t](n)},loadEvents:function(){var e,t,n,i;for(UTIL.fire("common"),D()&&UTIL.fire("common","desktop"),R()&&UTIL.fire("common","mobile"),t=0,n=(i=document.body.className.replace(/-/g,"_").split(/\s+/)).length;t<n;t++)e=i[t],UTIL.fire(e),D()&&UTIL.fire(e,"desktop"),R()&&UTIL.fire(e,"mobile");return UTIL.fire("common","post")},load:function(){return D()&&W()?ve():(K(),n("loaded",{html:!0}),UTIL.loadEvents())}},e(document).ready(UTIL.load)}(jQuery),Te=0,Ce=0,L=[],S=function(e){return console.log(e),!!$("body").hasClass("scrolling")||(n("scrolling"),setTimeout(function(){return Z("scrolling")},1e3),e.deltaY<0?B():G(),S)},pe=function(){return window.scrollTop=$window.scrollTop(),pe},h=function(){var e,t,n,i;return window.$sticky||(window.$sticky=$(".sticky-container")),window.stickyTop||(window.stickyTop=parseInt($(".sticky-container").css("top"))),!!$sticky.length&&(n=Math.max(0,$window.scrollTop()),t=Math.max(0,$window.scrollLeft()),i=Math.max(m(),stickyTop-n),e=-Math.min(parseInt($("body").css("min-width"))-$window.width(),t),$sticky.css({top:i,marginLeft:Math.min(0,e)}),h)},f=function(){return window.stickyTop=$("article").position().top,h(),f},u=function(){var e,t;return t=Math.max(0,$window.scrollLeft()),e=-Math.min(parseInt($("body").css("min-width"))-$window.width(),t),p().css({marginLeft:Math.min(0,e)}),u},d=function(){var e,t;return t=Math.max(0,$window.scrollLeft()),e=-Math.min(parseInt($("body").css("min-width"))-$window.width(),t),$(".popup .image, .project-images .banner").css({marginLeft:Math.min(0,e)}),u},o=function(){return $(document).keydown(function(e){switch(e.which){case 37:G();break;case 39:B()}return e.preventDefault()}),o},ce=function(){var e;return $(".popup").length||O()||T("project-images")||null==(e=p().currentFromOffset())||e.isActive()||(p().setCurrent(e),je(e),$(".images .image").deactivate()),ce},B=function(){return be(),U(),B},G=function(){return be(),Y(),G},U=function(){var e,t,n;return console.log("%c[next Image]","color:blue"),t=$(".image.block"),e=$(".image.block.active"),n="",n=e.index()<$(".image.block").length-1?$(".image.block").eq(e.index()+1):$(".image.block").eq(0),t.setCurrent(n),re(),U},Y=function(){var e,t,n;return console.log("prev Image"),t=$(".image.block"),e=$(".image.block.active"),n="",n=e.index()>0?$(".image.block").eq(e.index()-1):$(".image.block").eq($(".image.block").length-1),console.log(n),t.setCurrent(n),re(),Y},I=function(){return Te=setInterval(U,3e3),console.log("initSlideshow"),re(),I},be=function(){return clearInterval(Te),clearTimeout(Ce),Ce=setTimeout(function(){return Te=setInterval(U,6e3)},12e3),be},le=function(e){var t,n;return n=$(".block"),t=n.currentFromMousePosition(e),n.setCurrent(t),je(t),t.hasClass("excerpt_video")&&t.showMedia(),n.not(t).hideMedia(),le},ne=function(){var e,t;return console.log("scroll overview"),console.log($("body").scrollTop()),e=$(".banner").position().top+$(".banner").height(),console.log(e),$("body").scrollTop()>e?($("body")[0].scrollHeight-$window.height(),t=$("body").scrollTop(),t-e,$(".overview-block .text").addClass("sticky")):$(".overview-block .text").removeClass("sticky")},ie=function(){var e,t;return console.log($("body").scrollTop()),e=$(".banner").position().top+$(".banner").height(),console.log(e),$("body").scrollTop()>e?($("body")[0].scrollHeight-$window.height(),t=$("body").scrollTop(),t-e,$(".related-right").addClass("sticky")):$(".related-right").removeClass("sticky")},oe=function(){var e,t,n,i;if($(".sticky-container .related").height()+$(".sticky-container").position().top>$window.height())return e=($('.content[role="document"]').outerHeight()-$('.content[role="document"]').height())/2,t=$("body")[0].scrollHeight-$window.height(),n=$("body").scrollTop(),console.log(e),i=n/t*($(".sticky-container .related").height()-$window.height()+e),i=-i,void $(".sticky-container .related").css({"-webkit-transform":"translate(0px,"+i+"px)"})},fe=function(){var e,t,n;for(de(),$("body").trigger("scroll"),t=$("body")[0].scrollHeight,n=$(".image").last().data("unique-set")+1,console.log("totalImages "+n),$(".images").activate(),L=[],e=1;e<=n;)L.push(t/e-$window.height()/n),e++;return L.reverse(),fe},ge=function(){return ge},he=function(){return $(".sticky-container").removeClass("all-visible"),$(".popup").length||raf(function(){var e,t,n,i;for(n=$(".image"),e=0,i=0;i<L.length;)$("body").scrollTop()>=L[i]&&(e=i),i++;return $("body").scrollTop()>=$("body")[0].scrollHeight-$window.height()?e=L.length-1:$("body").scrollTop()<=L[1]&&(e=0),(t=$(".image[data-unique-set="+e+"]")).hasClass("active")?de:(n.not(t).deactivate(),t.each(function(){$(this).activate()}),n.active().showMedia(),n.inactive().hideMedia())}),he},se=function(){return console.log("setContentSticky"),$(".sticky-container").addClass("all-visible"),se},de=function(){return $(".overview-block").position().top+$(".overview-block").height()<$(window).height()?(se(),ne(),$(".related-right").height()<$(window).height()&&ie()):he(),ge(),oe(),de},ue=function(){return window.$footnotes||(window.$footnotes=$($(".footnote").get().reverse())),oe(),$(".popup").length||raf(function(){var e,t,n,i;for(n=$(".image"),t=0,i=0;i<L.length;)$("body").scrollTop()>=L[i]&&(t=i),i++;return $("body").scrollTop()>=$("body")[0].scrollHeight-$window.height()?t=L.length-1:$("body").scrollTop()<=L[1]&&(t=0),e=$(".image").eq(t),n.not(e).deactivate(),e.activate(),n.active().showMedia(),n.inactive().hideMedia()}),ue},l=function(){if($("#menu-projects-sub-navigation").length&&$(".menu-projects").activate(),$("#menu-research-sub-navigation").length&&$(".menu-research").activate(),$("#menu-information-sub-navigation").length&&$(".menu-info").activate(),T("post-type-archive-project"))return $(".menu-archive").activate()},re=function(){var e,t,n;return console.log("set captions"),t=$(".block.active"),e=$("body"),n=t.hasClass("white"),e.toggleClass("white-text",n),Ie(n),$(".description").dotdotdot({ellipsis:" [...]",watch:"window"}),$(".description").off("mouseenter mouseleave",xe),$(".description.is-truncated").on("mouseenter",we).on("mouseleave",x)},we=function(e){return e.stopPropagation(),$(".block.active .description").addClass("expanded"),$(".block.slick-active .description").addClass("expanded"),$(".block.active .description").trigger("destroy"),$(".block.slick-active .description").trigger("destroy"),console.log("show caption")},x=function(e){return e.stopPropagation(),$(".block.active .description").removeClass("expanded"),$(".block.slick-active .description").removeClass("expanded"),console.log("hide caption"),$(".description").dotdotdot({ellipsis:" [...]",watch:"window"})},xe=function(e){return e.stopPropagation(),$(".block.active .description").toggleClass("expanded"),$(".block.slick-active .description").toggleClass("expanded"),$(".block.active .description").hasClass("expanded")&&$(".block.active .description").hasClass("is-truncated")?(console.log("destroy elips"),$(".block.active .description").trigger("destroy")):$(".description").dotdotdot({ellipsis:" [...]",watch:"window"}),$(".block.slick-active .description").hasClass("expanded")&&$(".block.slick-active .description").hasClass("is-truncated")?(console.log("destroy elips"),$(".block.slick-active .description").trigger("destroy")):$(".description").dotdotdot({ellipsis:" [...]",watch:"window"}),be()},t=function(){return $(".page-slideshow img").each(function(){return $(this).addClass("thumbnail")})},J=function(){return setTimeout(function(){return Z("init-slideshow"),$(".block-slideshow").removeClass("init-slideshow")},500)},a=function(){return be(),Z("contents-hidden popup")},_e=function(){return $(".images .image").on("click",function(e){if(!$(".popup").length)return $(this).openPopup({fakePage:!1,selectImage:$(e.currentTarget).index()})})},Pe=function(){return $(".page-slideshow .thumbnail").length&&($("#menu-primary-navigation").append('<button class="close"><i></i></button>'),$(".close").mouseenter(function(){return n("blur-content")}),$(".close").mouseleave(function(){return Z("blur-content")}),$(".close").click(function(){return a()})),$(".page-slideshow .thumbnail").on("click",function(){if(n("contents-hidden init-slideshow"),$(".block-slideshow .block").removeClass("active"),$(".block-slideshow .block").eq($(this).index()-1).addClass("active"),setTimeout(function(){return Z("init-slideshow")},500),!$(".popup").length)return $(this).openPopup({fakePage:!1}),n("popup")})},ze=function(){return $(".subnav .active .controls a").click(function(e){var t,n;return e.preventDefault(),t=$(this),n=t.parents(".control-item").prevAll().length,$window.scrollTop($(".subsection").eq(n).offset().top-w())})},Le=function(){var e;return(e=$(".main-nav a")).mouseenter(function(){return n("blur-content")}),e.mouseleave(function(){return Z("blur-content")})},He=function(){var e;return e=$(".newsletter-form"),$(".show-newsletter-form").click(function(){return e.toggle(),$e()}),e.find(".submit").click(function(){return e.submit()})},$e=function(){return $('form input[type="text"]').each(function(){var e,t,n,i;return(n=$(this)).parents(".input-wrapper").length||n.wrap('<div class="input-wrapper">'),i=n.parents(".input-wrapper"),t=n.parent().siblings("label"),e=n.parents("form"),i.css({marginLeft:t.outerWidth()}),n.css({width:e.width()-t.outerWidth()})}),$e},ae=function(){return $("#cscf").length&&(console.log("form exists"),$("#cscf_name").attr("placeholder","Name:").show(),$("#cscf_email").attr("placeholder","Email:").show(),$("#cscf_message").attr("placeholder","Message:").show(),$("#cscf_SubmitButton").attr("value","Submit").show()),ae},te=function(){var e;return e=$(".popup .video-positioner").add(".home .excerpt_video .video-positioner").add(".slideshow .video-positioner").add(".touch .project-overview .video-positioner").add(window.backgroundImages),raf(function(){return c(ee,e)}),te},c=function(e,t){return $.each(t,function(t,n){return e(n)})},ee=function(e,t){var n,i,o,r,a,s,c,l,u,d,h;if(null==t&&(t={}),n=$(e),l=n.data("ratio"),o=(!N()||!$(".is-small").length)&&n.data("full-bleed"),s=n.largeImagePadding(),D()?(h=Math.max(C(),1120),u=y()):(c=T("project-images")?".image":N()?".image":".block",h=(i=n.parents(c)).outerWidth(),u=i.outerHeight()),o?(r=(d=h)/l)<u&&(d=(r=u)*l):(a=u-2*s.y,(r=(d=h-2*s.x)/l)>a&&(d=(r=a)*l)),n.css({position:"absolute",top:"50%",left:"50%",marginLeft:-d/2,marginTop:-r/2,height:r,width:d}),R()&&!o)return $(this).backgroundCaption().css({position:"absolute",top:"50%",bottom:"auto",marginTop:r/2+m()/2,textAlign:"center"})},$.fn.largeImagePadding=function(){var e,t,n;return N()&&$(".is-small").length?{x:w(),y:0}:R()?(n=_()?X()?4.5:3.5:2.5,{x:w(),y:w()+m()*n}):(e=$(this).backgroundCaption(),t=Math.max(m(),e.height()),{x:w(),y:w()+m()+t})},$.fn.backgroundCaption=function(){return O()?$(this).parents(".block-inner").find("h1"):$(this).parents(".image").find(".caption")},r=function(){return raf(function(){return $(".block").each(function(e,t){return $(t).calculateExcerpt()})})},qe=function(){return $(".block").click(function(e){if(e.preventDefault(),O()){if(!$(e.target).hasClass("slideshow-nav"))return e.clientX>.5*$(window).width()?B():G()}else if(!$(e.target).hasClass("slideshow-nav")&&!$("body").hasClass("contents-hidden"))return e.clientX>.5*$(window).width()?B():G()})},Q=function(){return $(".video-player").each(function(e,t){var n;return n=$(t),n.offset().top,n.play()}),Q},V=function(){return $(".video-player").each(function(e,t){var n,i;return n=$(t),(i=n.offset().top)>window.scrollTop-n.outerHeight()&&i<window.scrollTop+2*$window.height()?n.play():n.pause()}),console.log("play visible videos"),V},H=function(){var e;return e=$("table"),$('<div class="liberated-blocks">').append(e.find(".block").clone()).insertBefore(e)},P=function(){return $(".block.expanded").each(function(){var e,t,n,i,o;return(e=$(this)).find(".related, article").remove(),e.removeClass("expanded"),i=e.find(".images"),(n=i.find(".image:first-child")).hasClass("video")?(o=n.find(".video-player"),e.addClass("excerpt_video")):(t=n.find("img"),o=$('<div class="background"></div>').attr("data-full-bleed",t.attr("data-full-bleed")).attr("data-ratio",t.attr("data-ratio")).attr("data-image",t.attr("src")),e.addClass("excerpt")),i.replaceWith(o)})},q=function(){return $(".images").insertAfter($(".text h1").first())},M=function(){var e;if(!(e=b()).hasClass("do-blur"))return e.is(":visible")?(n("loaded",{html:!0}),e.trigger("loaded"),e.stop().fadeOut(400),$(".video-player.should-play").parent().showMedia()):void 0;e.data("hold",!0)},ve=function(){var e,t;return t=b(),e=p().find(".background").first().clone(),t.find(".headline").mouseenter(function(){return t.addClass("do-blur")}).mouseleave(function(){if(t.removeClass("do-blur"),t.data("hold"))return M()}),e.length&&(e.css({opacity:0}),t.toggleClass("white-text",e.parents(".block").hasClass("white")),t.prepend(e),t.imagesLoaded(function(){return e.fadeTo(400,1)})),setTimeout(M,4e3),t.click(M),raf(function(){return t.show(),A(),UTIL.loadEvents()})},i=function(e,t){return b().length?b().on("loaded",function(){return setTimeout(e,t)}):e()},W=function(){return!!b().length&&!z()},z=function(){return null!=$.cookie("loader_shown")},A=function(){return $.cookie("loader_shown",!0)},ke=function(){return j()&&$("table .block").hide().css({width:$("table").width()/2}).show(),ke},me=function(){var e,t,i,o,r,a;for(n("flash-video",{html:!0}),t=function(){return O()?($(".block.excerpt_video").active().showMedia(),$(".block.expanded .image:visible").showMedia()):T("post-type-archive-project")?V():$(".image").active().showMedia()},a=[],i=0,o=(r=[1e3,2e3,4e3]).length;i<o;i++)e=r[i],a.push(setTimeout(t,e));return a},R=function(){return Modernizr.touch},D=function(){return!Modernizr.touch},O=function(){return T("home")},F=function(){return null!=window.chrome},E=function(){return/firefox/i.test(navigator.userAgent)},j=function(){return!!(window.orientation%180)},_=function(){return!j()},X=function(){return screen.availWidth<400},N=function(){return R()&&T("project-overview")},ye=function(e,t,n){var i,o;return null==t&&(t=100),o=void 0,i=void 0,function(){var r,a;return r=n||this,a=+new Date,arguments,o&&a<o+t?(clearTimeout(i),i=setTimeout(function(){return o=a,raf(e.bind(r))},t)):(o=a,raf(e.bind(r)))}},m=function(){return parseInt(g().css("line-height"))},w=function(){return window.$bodyPadding||(window.$bodyPadding=$("#body-padding")),parseInt(window.$bodyPadding.css("height"))},C=function(){return R()?_()?screen.availWidth:screen.availHeight:$window.width()},y=function(){return R()?_()?screen.availHeight:screen.availWidth:$window.height()},p=function(){return window.$blocks=$($(".block").get().reverse()),window.$blocks},g=function(){return window.$body||(window.$body=$("body")),window.$body},v=function(){return window.$_html||(window.$_html=$("html")),window.$_html},b=function(){return window.$_loader||(window.$_loader=$("#loader")),window.$_loader},K=function(){return b().remove(),delete window.$_loader},T=function(e,t){return null==t&&(t={}),k(t).hasClass(e)},Me=function(e,t,n){return null==n&&(n={}),k(n).toggleClass(e,t)},n=function(e,t){return null==t&&(t={}),k(t).addClass(e)},Z=function(e,t){return null==t&&(t={}),k(t).removeClass(e)},Ie=function(e){return Me("white-text",e)},je=function(e){return Ie(e.hasClass("white"))},k=function(e){return null==e&&(e={}),e.html?v():g()},$.fn.activate=function(){return $(this).addClass("active")},$.fn.deactivate=function(){return $(this).removeClass("active")},$.fn.isActive=function(){return $(this).hasClass("active")},$.fn.active=function(){return $(this).filter(".active")},$.fn.inactive=function(){return $(this).not(".active")},$.fn.createMedia=function(){return $(this).eachVideo(s)},$.fn.showMedia=function(){var e;return e=$(this),e.find(".video-player").each(function(e,t){var n;return(n=$(t)).sizeMedia(),O()&&!T("loaded",{html:!0})?n.addClass("should-play"):n.play()}),e},$.fn.sizeMedia=function(){var e,t,n,i,o;return t=$(this),e=t.find(".video-positioner"),o=e.data("ratio"),i=t.parents(".popup").length||t.parents(".slideshow").length||N()||O()&&t.parents(".excerpt_video").length,t.toggleClass("inline-video",!i),n=e.data("poster"),i?e.css({paddingTop:""}):e.css({paddingTop:100/o+"%",width:"100%",height:0,position:"",height:"",margin:"",top:"",left:"",backgroundImage:'url("'+n+'")'})},$.fn.hideMedia=function(){var e;return e=$(this),e.find(".video-player").each(function(e,t){return $(t).pause()}),e},$.fn.eachVideo=function(e){var t,n,i,o;for(n=0,i=(o=(t=$(this)).find(".video-player").get()).length;n<i;n++)e(o[n]);return t},$.fn.play=function(){var e,t,n;if(e=$(this),n=e.data("videojs"),t=e.data("play-sound"),null!=n?n.hasLoaded:void 0)try{return n.ready(function(){return"Flash"===this.techName&&(e.hasClass("is-loaded")||n.one("loadeddata",function(){return setTimeout(function(){return raf(function(){return e.addClass("is-loaded")})},50)}),this.muted(!t)),this.play()})}catch(e){e}},$.fn.pause=function(){var e;if(null!=(e=$(this).data("videojs"))?e.hasLoaded:void 0)return e.ready(function(){return this.pause()})},s=function(e){var t,n;if("undefined"!=typeof videojs&&null!==videojs)return t=$(e),null==(n=t.data("videojs"))&&((n=videojs(t.find("video").get(0))).volume(t.data("play-sound")?1:0),n.controls(!1),R()?(n.height(1),n.width(1)):(n.height("100%"),n.width("100%")),n.ready(function(){return this.hasLoaded=!0}),$(n.el()).addClass("vjs-player"),t.find(".play-button").on("click",function(e){if(e.stopPropagation(),e.preventDefault(),n.hasLoaded)return n.play(),n.requestFullscreen()}),t.sizeMedia(),t.data("videojs",n)),n},$.fn.backgroundFrom=function(e){var t,n,i;if(window.backgroundImages||(window.backgroundImages=[]),t=$(this),i=e.data("image")||e.attr("src"),!t.find("img").length)return(n=$("<img>",{src:i,class:"background-image"})).attr("data-ratio",e.data("ratio")),n.attr("data-full-bleed",e.data("full-bleed")),n.css({display:"block"}),n.appendTo(t),backgroundImages.push(n),e.css({display:""}),ee(n),t},$.fn.setupBackgrounds=function(){return $(this).each(function(e,t){var n;return(n=$(t).find(".background")).backgroundFrom(n)})},$.fn.currentFromOffset=function(e){var t,n,i;return null==e&&(e={}),n=null,t=$(this),i=e.hold||(e.hold=0),t.each(function(e,o){var r,a,s;if(r=$(o),s=r.offset().top,a=w(),i>0){if(s<=window.scrollTop+a&&s+r.height()+i>=window.scrollTop-a||s>=window.scrollTop&&e===t.length-1)return n=r,!1}else if(O()&&(a+=$window.height()/2),s<=window.scrollTop+a||e===t.length-1)return n=r,!1}),n},$.fn.currentFromMousePosition=function(e,t){var n,i,o;return null==t&&(t={}),n=$(this),!(null!=e&&n.length>1)||O()&&b().is(":visible")?null!=t.default?n.eq(t.default):n.first():(o=e.pageX-$window.scrollLeft(),i=$window.width()/n.length,n.eq(Math.min(n.length-1,Math.floor(o/i))))},$.fn.setCurrent=function(e){if(setTimeout(function(){return $(".block-init").removeClass("block-init")},500),!e.isActive())return $(this).not(e).deactivate().trigger("deactivate"),e.activate().trigger("activate")},$.fn.hasTransitionClass=function(){return $(this).hasClass("is-swiping")},$.fn.addTransitionClass=function(){var e;if(!(e=$(this)).hasClass("is-swiping"))return e.addClass("is-swiping")},$.fn.removeTransitionClass=function(){return $(this).removeClass("is-swiping")},$.fn.makeSlideshow=function(e){var t,n,i,o,r,a;return null==e&&(e={}),t=$(this),r='<div data-role="none" class="previous">Previous</div>',o='<div data-role="none" class="next">Next</div>',i=function(e){return function(){return $(e).addTransitionClass()}}(this),n=function(){var e;return e=this.$slides.eq(this.currentSlide),N()||je(e),this.$slider.removeTransitionClass(),re()},a={arrows:!0,dots:!1,infinite:!1,slide:e.items||".image",prevArrow:r,nextArrow:o,onAfterChange:n},t.slick(a).on("touchmove.slick",i).on("click",".previous:not(.slick-disabled)",i).on("click",".next:not(.slick-disabled)",i).find(".previous, .next").css({display:""}),N()||je(t.find(".slick-active")),re(),t},$.fn.openPopup=function(e){var t,r,a,s;if(null==e&&(e={}),!$(".popup").length)return setTimeout(function(){return qe()},500),a=$(".image"),t=$(".image").eq(e.selectImage),a.not(t).deactivate(),a.active().showMedia(),a.inactive().hideMedia(),s=$(this),r=s.parents(".images"),a=r.find(".image"),$("body").hasClass("page")&&(a=(r=s.parents(".page-slideshow")).find(".thumbnail")),a.addCounters(),a.setupBackgrounds(),R()?(r.addClass("slideshow"),a.each(function(e,t){var n;return(n=$(t)).activate(),n.showMedia()}),r.find(".container").makeSlideshow(),te()):($window.on("mousewheel",S),o(),$(".block-slideshow .block").first().addClass("active"),$(".block-slideshow .block").setupBackgrounds(),I(),i(function(){return $(".prev-image").on("click",G),$(".next-image").on("click",B),console.log("init slideshow"),Q()},1e3),r.addClass("popup"),n("contents-hidden")),re()},$.fn.fanImages=function(e){var t,n,i,o,r;return null==e&&(e={}),n=$(this),t=i=n.parents(".images"),T("project-overview")&&(o=window.scrollTop,$(".menu-images").activate(),$(".menu-overview").deactivate().click(function(e){return e.preventDefault(),$(".menu-overview").activate(),$(".menu-images").deactivate(),i.unbind("mousemove"),i.removeClass("popup"),i.hideMedia().show(),$window.unbind("scroll.popup"),Z("blur-content"),Z("contents-hidden"),$(".wrap").css({height:""}),$window.scrollTop(o),$window.trigger("scroll"),$window.trigger("resize")})),r=function(i){var o,a;if(!(o=n.currentFromMousePosition(i,{default:e.currentIndex})).isActive()){a=o.hasClass("white"),n.setCurrent(o),t.toggleClass("white-text",a),Ie(a);try{o.showMedia(),n.not(o).hideMedia()}catch(e){e}te()}return r},$window.on("scroll.popup",d),setTimeout(function(){return t.on("mousemove",r)},200),r()},$.fn.addCounters=function(){var e;if((e=$(this)).length>1)return e.each(function(t,n){return'<div class="counter">'+(t+1)+"/"+e.length+"</div>",$(n).find(".caption-inner")})},$.fn.openHref=function(){var e;if(null!=(e=$(this).data("href")))return window.location=e},$.fn.openSelectProjects=function(){var e;if(null!=(e=$(".menu-projects a").attr("href")+"/type/selected"))return window.location=e},$.fn.calculateExcerpt=function(){var t,n;return t=$(this),null==(n=t.data("excerptCalculator"))&&(n=new e(t),t.data("excerptCalculator",n)),(R()||!O()||t.hasClass("active"))&&n.render(),t},$.fn.slickReinit=function(){return $(this).slickSetOption("_",!0,!0)},e=function(){function e(e){this.block=e,this.$article=this.block.find("article").first(),this.$images=this.block.find(".images .image"),this.$related=this.block.find(".related_post"),$window.on("resize",this.render.bind(this)),this.block.on("activate",this.render.bind(this)),R()&&$window.on("orientationchange",this.render.bind(this))}return e.prototype.render=function(){return raf(function(e){return function(){var t,n;return n=e.getTargetHeight(),t=e.approximateWidth(),e.currentHeight===n&&e.currentWidth===t||(e.$article.length&&e.truncateArticle(n,t),e.$images.length&&e.truncateImages(n,t),e.$related.length&&e.truncateRelated(n,t)),e.$images.filter(":visible").showMedia(),e.$images.not(":visible").hideMedia(),e.currentHeight=n,e.currentWidth=t}}(this))},e.prototype.truncateArticle=function(e,t){var n,i,o,r,a,s,c,l,u,d;if(R()&&(e-=this.block.find("h1").outerHeight(!0)),D()&&O()&&(e-=2*m()),this.paragraphs||(this.paragraphs=this.getParagraphs()),o=!1,this.$article.empty(),e>m()){for(a=0,c=(u=this.paragraphs).length;a<c;a++)if(i=u[a],n=i.el.clone(),this.$article.append(n),this.$article.height()>e){for(n.empty(),s=0,l=(d=i.words).length;s<l;s++)if(r=d[s],n.append(r.clone()," "),this.$article.height()>e){o=!0;break}break}return o&&(n.find("> span:last-child").remove(),n.find("> span:last-child").remove(),n.find("> span").length&&n.append("<span>[&hellip;]</span>")),this.$article.html(this.$article.html())}},e.prototype.truncateImages=function(e,t){var n,i,o,r,a,s,c;for(e+=m()*(null!=(a=R())?a:{1:3}),this.$images.hide(),c=[],o=0,r=(s=this.$images).length;o<r;o++){if(i=s[o],(n=$(i)).show(),this.imagesHeight()>e){n.hide();break}c.push(void 0)}return c},e.prototype.imagesHeight=function(){return this.$imagesContainer||(this.$imagesContainer=this.block.find(".images")),this.$imagesContainer.height()},e.prototype.truncateRelated=function(e,t){var n,i,o,r,a,s;for(e+=3*m(),this.$related.hide(),s=[],o=0,r=(a=this.$related).length;o<r;o++){if(i=a[o],(n=$(i)).showMedia().show(),this.relatedHeight()>e){n.hideMedia().hide();break}s.push(void 0)}return s},e.prototype.relatedHeight=function(){return this.$relatedContainer||(this.$relatedContainer=this.block.find(".related")),this.$relatedContainer.height()},e.prototype.getTargetHeight=function(){var e,t,n;return R()&&(this.block.hasClass("writing")||this.block.hasClass("expanded"))?((e=parseInt(this.block.css("max-height")))||(e=this.block.height()),e-2*m()):(t=3*w()+3*m()-5,(n=$window.height())-t-n%m())},e.prototype.getParagraphs=function(){var e;return e=[],this.$article.find("p").each(function(t){return function(n,i){var o;return o=t.getWords(i),i=$(i).clone(),e.push({el:i,words:o})}}(this)),e},e.prototype.getWords=function(e){var t,n,i,o,r;for(r=[],n=0,i=(o=this.getText(e).split(" ")).length;n<i;n++)t=o[n],r.push(this.makeWord(t));return r},e.prototype.getText=function(e){return $.trim($(e).text())},e.prototype.makeWord=function(e){return $("<span>").html(e.replace(/SO\u2013IL/,'<span class="wordmark">SO<span class="hyphen">&ndash;</span>IL</span>'))},e.prototype.approximateWidth=function(){var e;return(e=this.$article.width())-e%10},e}()}).call(this);